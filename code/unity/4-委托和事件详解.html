<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.49" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://wingsnow.github.io/wingsnow-blog/wingsnow-blog/code/unity/4-%E5%A7%94%E6%89%98%E5%92%8C%E4%BA%8B%E4%BB%B6%E8%AF%A6%E8%A7%A3.html"><meta property="og:site_name" content="冬天吃雪糕的博客"><meta property="og:title" content="委托(delegate)和事件(event)详解"><meta property="og:description" content="本文通过两个范例由浅入深地讲述什么是委托、为什么要使用委托、事件的由来、.Net Framework 中的委托和事件、委托和事件对 Observer 设计模式的意义，对它们的中间代码也做了讨论。"><meta property="og:type" content="article"><meta property="og:updated_time" content="2022-09-15T07:58:15.000Z"><meta property="og:locale" content="zh-CN"><meta property="article:tag" content="转载"><meta property="article:tag" content="C#"><meta property="article:published_time" content="2022-08-30T00:00:00.000Z"><meta property="article:modified_time" content="2022-09-15T07:58:15.000Z"><link rel="icon" href="./favicon.ico"><title>委托(delegate)和事件(event)详解 | 冬天吃雪糕的博客</title><meta name="description" content="本文通过两个范例由浅入深地讲述什么是委托、为什么要使用委托、事件的由来、.Net Framework 中的委托和事件、委托和事件对 Observer 设计模式的意义，对它们的中间代码也做了讨论。">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d2025;
      }

      html,
      body {
        background-color: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="stylesheet" href="/wingsnow-blog/assets/style.acb67ab8.css">
    <link rel="modulepreload" href="/wingsnow-blog/assets/app.b12f069c.js"><link rel="modulepreload" href="/wingsnow-blog/assets/4-委托和事件详解.html.b159739c.js"><link rel="modulepreload" href="/wingsnow-blog/assets/plugin-vue_export-helper.21dcd24c.js"><link rel="modulepreload" href="/wingsnow-blog/assets/4-委托和事件详解.html.15eb09b2.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.0d7faed9.js"><link rel="prefetch" href="/wingsnow-blog/assets/note.html.bd61cbd3.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.2d29783e.js"><link rel="prefetch" href="/wingsnow-blog/assets/1-fetch异常处理.html.60568ec6.js"><link rel="prefetch" href="/wingsnow-blog/assets/2-linter配置指南.html.8d59b555.js"><link rel="prefetch" href="/wingsnow-blog/assets/3-foreach、map、reduce和promise.html.c016c5b6.js"><link rel="prefetch" href="/wingsnow-blog/assets/4-使用koa2快速搭建接口服务器.html.70e9b656.js"><link rel="prefetch" href="/wingsnow-blog/assets/5-package.json使用指南.html.0161d3da.js"><link rel="prefetch" href="/wingsnow-blog/assets/6-SemVer语义化版本规范.html.0b80ad55.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.d962c886.js"><link rel="prefetch" href="/wingsnow-blog/assets/1-VMware安装Ubuntu.html.252e3ca4.js"><link rel="prefetch" href="/wingsnow-blog/assets/2- 配置node环境.html.8493f9e0.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.3422fec8.js"><link rel="prefetch" href="/wingsnow-blog/assets/1-mathf库介绍.html.97bdedcc.js"><link rel="prefetch" href="/wingsnow-blog/assets/10-数据容器ScriptableObject.html.41fcd6a0.js"><link rel="prefetch" href="/wingsnow-blog/assets/11-Awake和Start的区别.html.05ba5f8e.js"><link rel="prefetch" href="/wingsnow-blog/assets/12-unity实现物体沿曲线运动.html.db037910.js"><link rel="prefetch" href="/wingsnow-blog/assets/13-unity读取xml文件.html.5bb74923.js"><link rel="prefetch" href="/wingsnow-blog/assets/2-浅谈unity中的各种移动.html.12ce8ebb.js"><link rel="prefetch" href="/wingsnow-blog/assets/3-unity的时间逻辑.html.ac476a1d.js"><link rel="prefetch" href="/wingsnow-blog/assets/5-unity的随机数.html.ff092862.js"><link rel="prefetch" href="/wingsnow-blog/assets/6-unity延时调用.html.22815904.js"><link rel="prefetch" href="/wingsnow-blog/assets/7-跟随鼠标移动.html.b1672313.js"><link rel="prefetch" href="/wingsnow-blog/assets/8-获取游戏对象的包围盒.html.585540af.js"><link rel="prefetch" href="/wingsnow-blog/assets/9-判断物体是否在屏幕内.html.ea74e8fb.js"><link rel="prefetch" href="/wingsnow-blog/assets/99-(todo)Unity编辑器扩展基础.html.faa761da.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.18736f50.js"><link rel="prefetch" href="/wingsnow-blog/assets/1-vue3组件间通信.html.ff5ae590.js"><link rel="prefetch" href="/wingsnow-blog/assets/2-在VSCode添加代码片段.html.9fb050ad.js"><link rel="prefetch" href="/wingsnow-blog/assets/3-vite使用cdn加载库文件.html.df10fff6.js"><link rel="prefetch" href="/wingsnow-blog/assets/4-vue批量导入静态资源.html.4f1db67c.js"><link rel="prefetch" href="/wingsnow-blog/assets/5-vue插件开发.html.19a24390.js"><link rel="prefetch" href="/wingsnow-blog/assets/6-vue 组件带类型推断的 ref 写法.html.adabe50f.js"><link rel="prefetch" href="/wingsnow-blog/assets/7-vite使用ionicons.html.94c74684.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.197b9930.js"><link rel="prefetch" href="/wingsnow-blog/assets/1-做个骰子.html.8a12ccf7.js"><link rel="prefetch" href="/wingsnow-blog/assets/2-自定义消息框.html.b6ff1fec.js"><link rel="prefetch" href="/wingsnow-blog/assets/3-打字机效果文本.html.2bab1316.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.e4e35a98.js"><link rel="prefetch" href="/wingsnow-blog/assets/404.html.e2d88369.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.4f451601.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.b107328c.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.b0c70922.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.2a2a7491.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.68cb95a1.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.fff82f3c.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.a33ec080.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.3df0f7cf.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.9c295e9b.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.7add276b.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.ced706f9.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.10e4e043.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.6ed032f5.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.fcc77962.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.178e98d6.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.c207471d.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.4602bb9c.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.2bf4253c.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.3d3a5208.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.e8da1159.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.d52e1e1c.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.231dfdb9.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.9e40d108.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.b3201650.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.0d1cd9fd.js"><link rel="prefetch" href="/wingsnow-blog/assets/note.html.7e512c5b.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.1394e8d9.js"><link rel="prefetch" href="/wingsnow-blog/assets/1-fetch异常处理.html.0daac437.js"><link rel="prefetch" href="/wingsnow-blog/assets/2-linter配置指南.html.5a1fa538.js"><link rel="prefetch" href="/wingsnow-blog/assets/3-foreach、map、reduce和promise.html.d10b1eed.js"><link rel="prefetch" href="/wingsnow-blog/assets/4-使用koa2快速搭建接口服务器.html.3b475ed8.js"><link rel="prefetch" href="/wingsnow-blog/assets/5-package.json使用指南.html.fe1b110c.js"><link rel="prefetch" href="/wingsnow-blog/assets/6-SemVer语义化版本规范.html.b305a8dd.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.24e2f177.js"><link rel="prefetch" href="/wingsnow-blog/assets/1-VMware安装Ubuntu.html.48a7ce2e.js"><link rel="prefetch" href="/wingsnow-blog/assets/2- 配置node环境.html.0cdf6b7b.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.496d67f2.js"><link rel="prefetch" href="/wingsnow-blog/assets/1-mathf库介绍.html.b75087e3.js"><link rel="prefetch" href="/wingsnow-blog/assets/10-数据容器ScriptableObject.html.9042bdad.js"><link rel="prefetch" href="/wingsnow-blog/assets/11-Awake和Start的区别.html.3ec524b5.js"><link rel="prefetch" href="/wingsnow-blog/assets/12-unity实现物体沿曲线运动.html.a7a4266d.js"><link rel="prefetch" href="/wingsnow-blog/assets/13-unity读取xml文件.html.4ec325d4.js"><link rel="prefetch" href="/wingsnow-blog/assets/2-浅谈unity中的各种移动.html.b44930fd.js"><link rel="prefetch" href="/wingsnow-blog/assets/3-unity的时间逻辑.html.3ba57cc5.js"><link rel="prefetch" href="/wingsnow-blog/assets/5-unity的随机数.html.1127acb7.js"><link rel="prefetch" href="/wingsnow-blog/assets/6-unity延时调用.html.93273209.js"><link rel="prefetch" href="/wingsnow-blog/assets/7-跟随鼠标移动.html.4508dc81.js"><link rel="prefetch" href="/wingsnow-blog/assets/8-获取游戏对象的包围盒.html.e026f250.js"><link rel="prefetch" href="/wingsnow-blog/assets/9-判断物体是否在屏幕内.html.fcf8b0f3.js"><link rel="prefetch" href="/wingsnow-blog/assets/99-(todo)Unity编辑器扩展基础.html.ef167244.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.e691527a.js"><link rel="prefetch" href="/wingsnow-blog/assets/1-vue3组件间通信.html.5a52f0d3.js"><link rel="prefetch" href="/wingsnow-blog/assets/2-在VSCode添加代码片段.html.1370ae05.js"><link rel="prefetch" href="/wingsnow-blog/assets/3-vite使用cdn加载库文件.html.297ac413.js"><link rel="prefetch" href="/wingsnow-blog/assets/4-vue批量导入静态资源.html.03b1bbe3.js"><link rel="prefetch" href="/wingsnow-blog/assets/5-vue插件开发.html.efa5627a.js"><link rel="prefetch" href="/wingsnow-blog/assets/6-vue 组件带类型推断的 ref 写法.html.d0465d07.js"><link rel="prefetch" href="/wingsnow-blog/assets/7-vite使用ionicons.html.fae100db.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.8e51b620.js"><link rel="prefetch" href="/wingsnow-blog/assets/1-做个骰子.html.942d0c94.js"><link rel="prefetch" href="/wingsnow-blog/assets/2-自定义消息框.html.97a2831a.js"><link rel="prefetch" href="/wingsnow-blog/assets/3-打字机效果文本.html.cdba656e.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.b560b847.js"><link rel="prefetch" href="/wingsnow-blog/assets/404.html.73c00f42.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.d10869ab.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.1beede3d.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.154f0b2b.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.3ece323f.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.c59955ef.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.6c0845ee.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.1a198940.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.fe476996.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.3ade2c91.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.5f594081.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.f6c14e5e.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.35e7b02b.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.af762fb6.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.bbf4d183.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.e780d860.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.960ee360.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.3b269095.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.603a7e51.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.fbaaceb5.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.bb225357.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.393fa7dc.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.4a5f28c7.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.fa0b92e2.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.b77992f2.js"><link rel="prefetch" href="/wingsnow-blog/assets/404.6c991f4c.js"><link rel="prefetch" href="/wingsnow-blog/assets/Layout.31cd7643.js"><link rel="prefetch" href="/wingsnow-blog/assets/Blog.e850ff1f.js"><link rel="prefetch" href="/wingsnow-blog/assets/photoswipe.esm.03eca607.js"><link rel="prefetch" href="/wingsnow-blog/assets/CustomButton.ae438941.js"><link rel="prefetch" href="/wingsnow-blog/assets/Dice.1064797f.js"><link rel="prefetch" href="/wingsnow-blog/assets/PopAlter.6a63e8f2.js"><link rel="prefetch" href="/wingsnow-blog/assets/TyperText.9dc62f22.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">Skip to content</a><!--]--><div class="theme-container has-toc"><!--[--><!--[--><header class="navbar"><div class="navbar-left"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><a href="/wingsnow-blog/" class="brand"><img class="logo" src="/wingsnow-blog/logo.png" alt="冬天吃雪糕的博客"><!----><span class="site-name hide-in-pad">冬天吃雪糕的博客</span></a><!----></div><div class="navbar-center"><!----><nav class="nav-links"><div class="nav-item hide-in-mobile"><a href="/wingsnow-blog/" class="nav-link" aria-label="博客主页"><span class="icon iconfont icon-home"></span>博客主页<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="代码笔记"><span class="title"><span class="icon iconfont icon-code"></span>代码笔记</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>Web前端</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/wingsnow-blog/code/vue/" class="nav-link" aria-label="Vue笔记"><span class="icon iconfont icon-vue"></span>Vue笔记<!----></a></li><li class="dropdown-subitem"><a href="/wingsnow-blog/code/javascript/" class="nav-link" aria-label="JavaScript笔记"><span class="icon iconfont icon-javascript"></span>JavaScript笔记<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>游戏开发</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/wingsnow-blog/code/unity/" class="nav-link active" aria-label="Unity笔记"><span class="icon iconfont icon-view"></span>Unity笔记<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>后端运维</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/wingsnow-blog/code/ubuntu/" class="nav-link" aria-label="Ubuntu笔记"><span class="icon iconfont icon-ubuntu"></span>Ubuntu笔记<!----></a></li></ul></li><li class="dropdown-item"><a href="/wingsnow-blog/code/note.html" class="nav-link" aria-label="代码小记"><!---->代码小记<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="项目"><span class="title"><span class="icon iconfont icon-module"></span>项目</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/wingsnow-blog/projects/vueComponents/" class="nav-link" aria-label="Vue组件"><span class="icon iconfont icon-vue"></span>Vue组件<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><a href="/wingsnow-blog/design/" class="nav-link" aria-label="产品设计"><span class="icon iconfont icon-palette"></span>产品设计<!----></a></div></nav><!----></div><div class="navbar-right"><!----><!----><!----><div class="nav-item hide-in-mobile"><button id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!----><!----><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow left"></span></div><aside class="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-javascript"></span><span class="title">Javascript笔记</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-ubuntu"></span><span class="title">Ubuntu笔记</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable active"><span class="icon iconfont icon-view"></span><span class="title">Unity笔记</span><span class="arrow down"></span></button><ul class="sidebar-links"><li><!--[--><a href="/wingsnow-blog/code/unity/1-mathf%E5%BA%93%E4%BB%8B%E7%BB%8D.html" class="nav-link sidebar-link sidebar-page" aria-label="Mathf 库介绍"><!---->Mathf 库介绍<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/wingsnow-blog/code/unity/2-%E6%B5%85%E8%B0%88unity%E4%B8%AD%E7%9A%84%E5%90%84%E7%A7%8D%E7%A7%BB%E5%8A%A8.html" class="nav-link sidebar-link sidebar-page" aria-label="浅谈 Unity 中的各种移动"><!---->浅谈 Unity 中的各种移动<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/wingsnow-blog/code/unity/3-unity%E7%9A%84%E6%97%B6%E9%97%B4%E9%80%BB%E8%BE%91.html" class="nav-link sidebar-link sidebar-page" aria-label="Unity 的时间逻辑"><!---->Unity 的时间逻辑<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-current="page" href="/wingsnow-blog/code/unity/4-%E5%A7%94%E6%89%98%E5%92%8C%E4%BA%8B%E4%BB%B6%E8%AF%A6%E8%A7%A3.html" class="router-link-active router-link-exact-active nav-link active sidebar-link sidebar-page active" aria-label="委托(delegate)和事件(event)详解"><!---->委托(delegate)和事件(event)详解<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/wingsnow-blog/code/unity/4-%E5%A7%94%E6%89%98%E5%92%8C%E4%BA%8B%E4%BB%B6%E8%AF%A6%E8%A7%A3.html#引言" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="引言"><!---->引言<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/wingsnow-blog/code/unity/4-%E5%A7%94%E6%89%98%E5%92%8C%E4%BA%8B%E4%BB%B6%E8%AF%A6%E8%A7%A3.html#将方法作为方法的参数" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="将方法作为方法的参数"><!---->将方法作为方法的参数<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/wingsnow-blog/code/unity/4-%E5%A7%94%E6%89%98%E5%92%8C%E4%BA%8B%E4%BB%B6%E8%AF%A6%E8%A7%A3.html#将方法绑定到委托" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="将方法绑定到委托"><!---->将方法绑定到委托<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/wingsnow-blog/code/unity/4-%E5%A7%94%E6%89%98%E5%92%8C%E4%BA%8B%E4%BB%B6%E8%AF%A6%E8%A7%A3.html#事件的由来" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="事件的由来"><!---->事件的由来<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/wingsnow-blog/code/unity/4-%E5%A7%94%E6%89%98%E5%92%8C%E4%BA%8B%E4%BB%B6%E8%AF%A6%E8%A7%A3.html#事件和委托的编译代码" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="事件和委托的编译代码"><!---->事件和委托的编译代码<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/wingsnow-blog/code/unity/4-%E5%A7%94%E6%89%98%E5%92%8C%E4%BA%8B%E4%BB%B6%E8%AF%A6%E8%A7%A3.html#委托、事件与observer设计模式" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="委托、事件与Observer设计模式"><!---->委托、事件与Observer设计模式<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/wingsnow-blog/code/unity/4-%E5%A7%94%E6%89%98%E5%92%8C%E4%BA%8B%E4%BB%B6%E8%AF%A6%E8%A7%A3.html#范例说明" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="范例说明"><!---->范例说明<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/wingsnow-blog/code/unity/4-%E5%A7%94%E6%89%98%E5%92%8C%E4%BA%8B%E4%BB%B6%E8%AF%A6%E8%A7%A3.html#observer设计模式简介" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Observer设计模式简介"><!---->Observer设计模式简介<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/wingsnow-blog/code/unity/4-%E5%A7%94%E6%89%98%E5%92%8C%E4%BA%8B%E4%BB%B6%E8%AF%A6%E8%A7%A3.html#实现范例的observer设计模式" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="实现范例的Observer设计模式"><!---->实现范例的Observer设计模式<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/wingsnow-blog/code/unity/4-%E5%A7%94%E6%89%98%E5%92%8C%E4%BA%8B%E4%BB%B6%E8%AF%A6%E8%A7%A3.html#net-framework中的委托与事件" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label=".Net Framework中的委托与事件"><!---->.Net Framework中的委托与事件<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/wingsnow-blog/code/unity/4-%E5%A7%94%E6%89%98%E5%92%8C%E4%BA%8B%E4%BB%B6%E8%AF%A6%E8%A7%A3.html#总结" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="总结"><!---->总结<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/wingsnow-blog/code/unity/4-%E5%A7%94%E6%89%98%E5%92%8C%E4%BA%8B%E4%BB%B6%E8%AF%A6%E8%A7%A3.html#扩展-unityevent" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="扩展：UnityEvent"><!---->扩展：UnityEvent<!----></a><ul class="sidebar-sub-headers"></ul></li></ul><!--]--></li><li><!--[--><a href="/wingsnow-blog/code/unity/5-unity%E7%9A%84%E9%9A%8F%E6%9C%BA%E6%95%B0.html" class="nav-link sidebar-link sidebar-page" aria-label="Unity 的随机数"><!---->Unity 的随机数<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/wingsnow-blog/code/unity/6-unity%E5%BB%B6%E6%97%B6%E8%B0%83%E7%94%A8.html" class="nav-link sidebar-link sidebar-page" aria-label="Unity 的延时调用"><!---->Unity 的延时调用<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/wingsnow-blog/code/unity/7-%E8%B7%9F%E9%9A%8F%E9%BC%A0%E6%A0%87%E7%A7%BB%E5%8A%A8.html" class="nav-link sidebar-link sidebar-page" aria-label="跟随鼠标移动"><!---->跟随鼠标移动<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/wingsnow-blog/code/unity/8-%E8%8E%B7%E5%8F%96%E6%B8%B8%E6%88%8F%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%8C%85%E5%9B%B4%E7%9B%92.html" class="nav-link sidebar-link sidebar-page" aria-label="获取游戏对象的包围盒"><!---->获取游戏对象的包围盒<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/wingsnow-blog/code/unity/9-%E5%88%A4%E6%96%AD%E7%89%A9%E4%BD%93%E6%98%AF%E5%90%A6%E5%9C%A8%E5%B1%8F%E5%B9%95%E5%86%85.html" class="nav-link sidebar-link sidebar-page" aria-label="判断物体是否在屏幕内"><!---->判断物体是否在屏幕内<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/wingsnow-blog/code/unity/10-%E6%95%B0%E6%8D%AE%E5%AE%B9%E5%99%A8ScriptableObject.html" class="nav-link sidebar-link sidebar-page" aria-label="Unity 数据容器类 ScriptableObject"><!---->Unity 数据容器类 ScriptableObject<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/wingsnow-blog/code/unity/11-Awake%E5%92%8CStart%E7%9A%84%E5%8C%BA%E5%88%AB.html" class="nav-link sidebar-link sidebar-page" aria-label="Unity 中 Awake 和 Start 的区别"><!---->Unity 中 Awake 和 Start 的区别<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/wingsnow-blog/code/unity/12-unity%E5%AE%9E%E7%8E%B0%E7%89%A9%E4%BD%93%E6%B2%BF%E6%9B%B2%E7%BA%BF%E8%BF%90%E5%8A%A8.html" class="nav-link sidebar-link sidebar-page" aria-label="Unity 实现物体沿曲线运动"><!---->Unity 实现物体沿曲线运动<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/wingsnow-blog/code/unity/13-unity%E8%AF%BB%E5%8F%96xml%E6%96%87%E4%BB%B6.html" class="nav-link sidebar-link sidebar-page" aria-label="Unity 读取 xml 文件"><!---->Unity 读取 xml 文件<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/wingsnow-blog/code/unity/99-(todo)Unity%E7%BC%96%E8%BE%91%E5%99%A8%E6%89%A9%E5%B1%95%E5%9F%BA%E7%A1%80.html" class="nav-link sidebar-link sidebar-page" aria-label="Unity 编辑器扩展基础"><!---->Unity 编辑器扩展基础<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-vue"></span><span class="title">Vue笔记</span><span class="arrow right"></span></button><!----></section><!--]--></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->委托(delegate)和事件(event)详解</h1><div class="page-info"><!----><!----><span class="date-info" aria-label="写作日期📅" data-balloon-pos="down" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span>2022年8月30日</span><meta property="datePublished" content="2022-08-30T00:00:00.000Z"></span><span class="category-info" aria-label="分类🌈" data-balloon-pos="down" localizeddate="2022年8月30日" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="category icon"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><ul class="categories-wrapper"><li class="category category2 clickable" role="navigation">代码笔记</li><li class="category category1 clickable" role="navigation">Unity笔记</li><meta property="articleSection" content="代码笔记,Unity笔记"></ul></span><span aria-label="标签🏷" data-balloon-pos="down" localizeddate="2022年8月30日" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="tag icon"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><ul class="tags-wrapper"><li class="tag tag3 clickable" role="navigation">转载</li><li class="tag tag8 clickable" role="navigation">C#</li></ul><meta property="keywords" content="转载,C#"></span><span class="reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="down" localizeddate="2022年8月30日" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 25 分钟</span><meta property="timeRequired" content="PT25M"></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><div class="toc-header">此页内容</div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/wingsnow-blog/code/unity/4-%E5%A7%94%E6%89%98%E5%92%8C%E4%BA%8B%E4%BB%B6%E8%AF%A6%E8%A7%A3.html#引言" class="router-link-active router-link-exact-active toc-link level2">引言</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/wingsnow-blog/code/unity/4-%E5%A7%94%E6%89%98%E5%92%8C%E4%BA%8B%E4%BB%B6%E8%AF%A6%E8%A7%A3.html#将方法作为方法的参数" class="router-link-active router-link-exact-active toc-link level2">将方法作为方法的参数</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/wingsnow-blog/code/unity/4-%E5%A7%94%E6%89%98%E5%92%8C%E4%BA%8B%E4%BB%B6%E8%AF%A6%E8%A7%A3.html#将方法绑定到委托" class="router-link-active router-link-exact-active toc-link level2">将方法绑定到委托</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/wingsnow-blog/code/unity/4-%E5%A7%94%E6%89%98%E5%92%8C%E4%BA%8B%E4%BB%B6%E8%AF%A6%E8%A7%A3.html#事件的由来" class="router-link-active router-link-exact-active toc-link level2">事件的由来</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/wingsnow-blog/code/unity/4-%E5%A7%94%E6%89%98%E5%92%8C%E4%BA%8B%E4%BB%B6%E8%AF%A6%E8%A7%A3.html#事件和委托的编译代码" class="router-link-active router-link-exact-active toc-link level2">事件和委托的编译代码</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/wingsnow-blog/code/unity/4-%E5%A7%94%E6%89%98%E5%92%8C%E4%BA%8B%E4%BB%B6%E8%AF%A6%E8%A7%A3.html#委托、事件与observer设计模式" class="router-link-active router-link-exact-active toc-link level2">委托、事件与Observer设计模式</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/wingsnow-blog/code/unity/4-%E5%A7%94%E6%89%98%E5%92%8C%E4%BA%8B%E4%BB%B6%E8%AF%A6%E8%A7%A3.html#范例说明" class="router-link-active router-link-exact-active toc-link level3">范例说明</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/wingsnow-blog/code/unity/4-%E5%A7%94%E6%89%98%E5%92%8C%E4%BA%8B%E4%BB%B6%E8%AF%A6%E8%A7%A3.html#observer设计模式简介" class="router-link-active router-link-exact-active toc-link level3">Observer设计模式简介</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/wingsnow-blog/code/unity/4-%E5%A7%94%E6%89%98%E5%92%8C%E4%BA%8B%E4%BB%B6%E8%AF%A6%E8%A7%A3.html#实现范例的observer设计模式" class="router-link-active router-link-exact-active toc-link level3">实现范例的Observer设计模式</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/wingsnow-blog/code/unity/4-%E5%A7%94%E6%89%98%E5%92%8C%E4%BA%8B%E4%BB%B6%E8%AF%A6%E8%A7%A3.html#net-framework中的委托与事件" class="router-link-active router-link-exact-active toc-link level2">.Net Framework中的委托与事件</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/wingsnow-blog/code/unity/4-%E5%A7%94%E6%89%98%E5%92%8C%E4%BA%8B%E4%BB%B6%E8%AF%A6%E8%A7%A3.html#总结" class="router-link-active router-link-exact-active toc-link level2">总结</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/wingsnow-blog/code/unity/4-%E5%A7%94%E6%89%98%E5%92%8C%E4%BA%8B%E4%BB%B6%E8%AF%A6%E8%A7%A3.html#扩展-unityevent" class="router-link-active router-link-exact-active toc-link level2">扩展：UnityEvent</a></li><!----><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><h1 id="委托-delegate-和事件-event-详解" tabindex="-1"><a class="header-anchor" href="#委托-delegate-和事件-event-详解" aria-hidden="true">#</a> 委托(delegate)和事件(event)详解</h1><h2 id="引言" tabindex="-1"><a class="header-anchor" href="#引言" aria-hidden="true">#</a> 引言</h2><p><strong>委托</strong>和<strong>事件</strong>在 .Net Framework 中的应用非常广泛，然而，较好地理解委托和事件对很多接触 C# 时间不长的人来说并不容易。它们就像是一道槛儿，过了这个槛的人，觉得真是太容易了，而没有过去的人每次见到委托和事件就觉得心里别（biè）得慌，混身不自在。本文中，我将通过两个范例由浅入深地讲述什么是委托、为什么要使用委托、事件的由来、.Net Framework 中的委托和事件、委托和事件对 Observer 设计模式的意义，对它们的中间代码也做了讨论。</p><h2 id="将方法作为方法的参数" tabindex="-1"><a class="header-anchor" href="#将方法作为方法的参数" aria-hidden="true">#</a> 将方法作为方法的参数</h2><p>我们先不管这个标题如何的绕口，也不管委托究竟是个什么东西，来看下面这两个最简单的方法，它们不过是在屏幕上输出一句问候的话语：</p><div class="language-csharp ext-cs line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">GreetPeople</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 做某些额外的事情，比如初始化之类，此处略</span>
    <span class="token function">EnglishGreeting</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">EnglishGreeting</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Morning, &quot;</span> <span class="token operator">+</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>暂且不管这两个方法有没有什么实际意义。<code>GreetPeople</code>用于向某人问好，当我们传递代表某人姓名的<code>name</code>参数，比如说“Jimmy”，进去的时候，在这个方法中，将调用<code>EnglishGreeting</code>方法，再次传递<code>name</code>参数，<code>EnglishGreeting</code>则用于向屏幕输出 “Morning, Jimmy”。</p><p>现在假设这个程序需要进行全球化，哎呀，不好了，我是中国人，我不明白“Morning”是什么意思，怎么办呢？好吧，我们再加个中文版的问候方法：</p><div class="language-csharp ext-cs line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ChineseGreeting</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">)</span><span class="token punctuation">{</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;早上好, &quot;</span> <span class="token operator">+</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这时候，<code>GreetPeople</code>也需要改一改了，不然如何判断到底用哪个版本的 Greeting 问候方法合适呢？在进行这个之前，我们最好再定义一个枚举作为判断的依据：</p><div class="language-csharp ext-cs line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">Language</span><span class="token punctuation">{</span>
    English<span class="token punctuation">,</span> Chinese
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">GreetPeople</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">,</span> <span class="token class-name">Language</span> lang<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//做某些额外的事情，比如初始化之类，此处略</span>
    <span class="token function">swith</span><span class="token punctuation">(</span>lang<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">case</span> Language<span class="token punctuation">.</span>English<span class="token punctuation">:</span>
           <span class="token function">EnglishGreeting</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token keyword">break</span><span class="token punctuation">;</span>
       <span class="token keyword">case</span> Language<span class="token punctuation">.</span>Chinese<span class="token punctuation">:</span>
           <span class="token function">ChineseGreeting</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>OK，尽管这样解决了问题，但我不说大家也很容易想到，这个解决方案的可扩展性很差，如果日后我们需要再添加韩文版、日文版，就不得不反复修改枚举和<code>GreetPeople()</code>方法，以适应新的需求。</p><p>在考虑新的解决方案之前，我们先看看<code>GreetPeople</code>的方法签名：</p><div class="language-csharp ext-cs line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">GreetPeople</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">,</span> <span class="token class-name">Language</span> lang<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>我们仅看<code>string name</code>，在这里，<code>string</code>是参数类型，<code>name</code>是参数变量，当我们赋给<code>name</code>字符串“jimmy”时，它就代表“jimmy”这个值；当我们赋给它“张子阳”时，它又代表着“张子阳”这个值。然后，我们可以在方法体内对这个<code>name</code>进行其他操作。哎，这简直是废话么，刚学程序就知道了。</p><p>如果你再仔细想想，假如<code>GreetPeople()</code>方法可以接受一个参数变量，这个变量可以代表另一个方法，当我们给这个变量赋值<code>EnglishGreeting</code>的时候，它代表着<code>EnglsihGreeting()</code>这个方法；当我们给它赋值<code>ChineseGreeting</code>的时候，它又代表着<code>ChineseGreeting()</code>方法。我们将这个参数变量命名为<code>MakeGreeting</code>，那么不是可以如同给<code>name</code>赋值时一样，在调用<code>GreetPeople()</code>方法的时候，给这个<code>MakeGreeting</code>参数也赋上值么(<code>ChineseGreeting</code>或者<code>EnglsihGreeting</code>等)？然后，我们在方法体内，也可以像使用别的参数一样使用<code>MakeGreeting</code>。但是，由于<code>MakeGreeting</code>代表着一个方法，它的使用方式应该和它被赋的方法(比如<code>ChineseGreeting</code>)是一样的，比如：</p><div class="language-csharp ext-cs line-numbers-mode"><pre class="language-csharp"><code><span class="token function">MakeGreeting</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>好了，有了思路了，我们现在就来改改<code>GreetPeople()</code>方法，那么它应该是这个样子了：</p><div class="language-csharp ext-cs line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">GreetPeople</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">,</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> MakeGreeting<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">MakeGreeting</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>注意到 *** ，这个位置通常放置的应该是参数的类型，但到目前为止，我们仅仅是想到应该有个可以代表方法的参数，并按这个思路去改写<code>GreetPeople</code>方法，现在就出现了一个大问题：这个代表着方法的<code>MakeGreeting</code>参数应该是什么类型的？</p><div class="custom-container note"><p class="custom-container-title">注</p><p>这里已不再需要枚举了，因为在给<code>MakeGreeting</code>赋值的时候动态地决定使用哪个方法，是<code>ChineseGreeting</code>还是<code>EnglishGreeting</code>，而在这个两个方法内部，已经对使用“morning”还是“早上好”作了区分。</p></div><p>聪明的你应该已经想到了，现在是委托该出场的时候了，但讲述委托之前，我们再看看<code>MakeGreeting</code>参数所能代表的<code>ChineseGreeting()</code>和<code>EnglishGreeting()</code>方法的签名：</p><div class="language-csharp ext-cs line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">EnglishGreeting</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ChineseGreeting</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>如同<code>name</code>可以接受 string 类型的“true”和“1”，但不能接受 bool 类型的 true 和 int 类型的 1 一样，<code>MakeGreeting</code>的参数类型定义应该能够确定<code>MakeGreeting</code>可以代表的方法种类，再进一步讲，就是<code>MakeGreeting</code>可以代表的 ==方法的参数类型和返回类型== 。</p><p>于是，委托出现了：它定义了<code>MakeGreeting</code>参数所能代表的方法的种类，也就是<code>MakeGreeting</code>参数的类型。</p><div class="custom-container note"><p class="custom-container-title">注</p><p>如果上面这句话比较绕口，我把它翻译成这样：string 定义了<code>name</code>参数所能代表的值的种类，也就是<code>name</code>参数的类型。</p></div><p>本例中委托的定义：</p><div class="language-csharp ext-cs line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">delegate</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">GreetingDelegate</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>可以与上面<code>EnglishGreeting()</code>方法的签名对比一下，除了加入了<code>delegate</code>关键字以外，其余的是不是完全一样？</p><p>现在，让我们再次改动<code>GreetPeople()</code>方法，如下所示：</p><div class="language-csharp ext-cs line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">GreetPeople</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">,</span> <span class="token class-name">GreetingDelegate</span> MakeGreeting<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">MakeGreeting</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如你所见，委托<code>GreetingDelegate</code>出现的位置与 string 相同，string 是一个类型，那么<code>GreetingDelegate</code>应该也是一个类型，或者叫类(Class)。但是委托的声明方式和类却完全不同，这是怎么一回事？实际上， ==委托在编译的时候确实会编译成类== 。因为 Delegate 是一个类，所以在任何可以声明类的地方都可以声明委托。更多的内容将在下面讲述，现在，请看看这个范例的完整代码：</p><div class="language-csharp ext-cs line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Collections<span class="token punctuation">.</span>Generic</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Text</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> <span class="token namespace">Delegate</span> <span class="token punctuation">{</span>
  <span class="token comment">//定义委托，它定义了可以代表的方法的类型</span>
  <span class="token keyword">public</span> <span class="token keyword">delegate</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">GreetingDelegate</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">class</span> <span class="token class-name">Program</span> <span class="token punctuation">{</span>

      <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">EnglishGreeting</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Morning, &quot;</span> <span class="token operator">+</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ChineseGreeting</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;早上好, &quot;</span> <span class="token operator">+</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token comment">//注意此方法，它接受一个GreetingDelegate类型的方法作为参数</span>
      <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">GreetPeople</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">,</span> <span class="token class-name">GreetingDelegate</span> MakeGreeting<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">MakeGreeting</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">GreetPeople</span><span class="token punctuation">(</span><span class="token string">&quot;Jimmy Zhang&quot;</span><span class="token punctuation">,</span> EnglishGreeting<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token function">GreetPeople</span><span class="token punctuation">(</span><span class="token string">&quot;张子阳&quot;</span><span class="token punctuation">,</span> ChineseGreeting<span class="token punctuation">)</span><span class="token punctuation">;</span>
          Console<span class="token punctuation">.</span><span class="token function">ReadKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>输出如下：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>Morning, Jimmy Zhang
早上好, 张子阳
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>我们现在对委托做一个总结：</p><p><strong>委托是一个类，它定义了方法的类型，使得可以将方法当作另一个方法的参数来进行传递，这种将方法动态地赋给参数的做法，可以避免在程序中大量使用 If-Else/Switch 语句，同时使得程序具有更好的可扩展性。</strong></p><h2 id="将方法绑定到委托" tabindex="-1"><a class="header-anchor" href="#将方法绑定到委托" aria-hidden="true">#</a> 将方法绑定到委托</h2><p>看到这里，是不是有那么点如梦初醒的感觉？于是，你是不是在想：在上面的例子中，我不一定要直接在<code>GreetPeople()</code>方法中给<code>name</code>参数赋值，我可以像这样使用变量：</p><div class="language-csharp ext-cs line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">string</span></span> name1<span class="token punctuation">,</span> name2<span class="token punctuation">;</span>
    name1 <span class="token operator">=</span> <span class="token string">&quot;Jimmy Zhang&quot;</span><span class="token punctuation">;</span>
    name2 <span class="token operator">=</span> <span class="token string">&quot;张子阳&quot;</span><span class="token punctuation">;</span>

    <span class="token function">GreetPeople</span><span class="token punctuation">(</span>name1<span class="token punctuation">,</span> EnglishGreeting<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">GreetPeople</span><span class="token punctuation">(</span>name2<span class="token punctuation">,</span> ChineseGreeting<span class="token punctuation">)</span><span class="token punctuation">;</span>
    Console<span class="token punctuation">.</span><span class="token function">ReadKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>而既然委托<code>GreetingDelegate</code>和类型 string 的地位一样，都是定义了一种参数类型，那么，我是不是也可以这么使用委托？</p><div class="language-csharp ext-cs line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">GreetingDelegate</span> delegate1<span class="token punctuation">,</span> delegate2<span class="token punctuation">;</span>
    delegate1 <span class="token operator">=</span> EnglishGreeting<span class="token punctuation">;</span>
    delegate2 <span class="token operator">=</span> ChineseGreeting<span class="token punctuation">;</span>

    <span class="token function">GreetPeople</span><span class="token punctuation">(</span><span class="token string">&quot;Jimmy Zhang&quot;</span><span class="token punctuation">,</span> delegate1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">GreetPeople</span><span class="token punctuation">(</span><span class="token string">&quot;张子阳&quot;</span><span class="token punctuation">,</span> delegate2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    Console<span class="token punctuation">.</span><span class="token function">ReadKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如你所料，这样是没有问题的，程序一如预料的那样输出。这里，我想说的是委托不同于 string 的一个特性：可以将多个方法赋给同一个委托，或者叫将多个方法绑定到同一个委托，当调用这个委托的时候，将依次调用其所绑定的方法。在这个例子中，语法如下：</p><div class="language-csharp ext-cs line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">GreetingDelegate</span> delegate1<span class="token punctuation">;</span>
    delegate1 <span class="token operator">=</span> EnglishGreeting<span class="token punctuation">;</span> <span class="token comment">// 先给委托类型的变量赋值</span>
    delegate1 <span class="token operator">+=</span> ChineseGreeting<span class="token punctuation">;</span>   <span class="token comment">// 给此委托变量再绑定一个方法</span>

     <span class="token comment">// 将先后调用 EnglishGreeting 与 ChineseGreeting 方法</span>
    <span class="token function">GreetPeople</span><span class="token punctuation">(</span><span class="token string">&quot;Jimmy Zhang&quot;</span><span class="token punctuation">,</span> delegate1<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    Console<span class="token punctuation">.</span><span class="token function">ReadKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>输出为：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>Morning, Jimmy Zhang
早上好, Jimmy Zhang
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>实际上，我们可以也可以绕过<code>GreetPeople</code>方法，通过委托来直接调用<code>EnglishGreeting</code>和<code>ChineseGreeting</code>：</p><div class="language-csharp ext-cs line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">GreetingDelegate</span> delegate1<span class="token punctuation">;</span>
    delegate1 <span class="token operator">=</span> EnglishGreeting<span class="token punctuation">;</span> <span class="token comment">// 先给委托类型的变量赋值</span>
    delegate1 <span class="token operator">+=</span> ChineseGreeting<span class="token punctuation">;</span>   <span class="token comment">// 给此委托变量再绑定一个方法</span>

    <span class="token comment">// 将先后调用 EnglishGreeting 与 ChineseGreeting 方法</span>
    <span class="token function">delegate1</span><span class="token punctuation">(</span><span class="token string">&quot;Jimmy Zhang&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    Console<span class="token punctuation">.</span><span class="token function">ReadKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="custom-container note"><p class="custom-container-title">注</p><p>这在本例中是没有问题的，但回头看下上面<code>GreetPeople()</code>的定义，在它之中可以做一些对于<code>EnglshihGreeting</code>和<code>ChineseGreeting</code>来说都需要进行的工作，为了简便我做了省略。</p></div><p>注意这里，第一次用的<code>=</code>，是赋值的语法；第二次，用的是<code>+=</code>，是绑定的语法。如果第一次就使用<code>+=</code>，将出现“使用了未赋值的局部变量”的编译错误。</p><p>我们也可以使用下面的代码来这样简化这一过程：</p><div class="language-csharp ext-cs line-numbers-mode"><pre class="language-csharp"><code><span class="token class-name">GreetingDelegate</span> delegate1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">GreetingDelegate</span><span class="token punctuation">(</span>EnglishGreeting<span class="token punctuation">)</span><span class="token punctuation">;</span>
delegate1 <span class="token operator">+=</span> ChineseGreeting<span class="token punctuation">;</span>   <span class="token comment">// 给此委托变量再绑定一个方法</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>看到这里，应该注意到，这段代码第一条语句与实例化一个类是何其的相似，你不禁想到：上面第一次绑定委托时不可以使用<code>+=</code>的编译错误，或许可以用这样的方法来避免：</p><div class="language-csharp ext-cs line-numbers-mode"><pre class="language-csharp"><code><span class="token class-name">GreetingDelegate</span> delegate1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">GreetingDelegate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
delegate1 <span class="token operator">+=</span> EnglishGreeting<span class="token punctuation">;</span>   <span class="token comment">// 这次用的是 “+=”，绑定语法。</span>
delegate1 <span class="token operator">+=</span> ChineseGreeting<span class="token punctuation">;</span>   <span class="token comment">// 给此委托变量再绑定一个方法</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>但实际上，这样会出现编译错误： “GreetingDelegate”方法没有采用“0”个参数的重载。尽管这样的结果让我们觉得有点沮丧，但是编译的提示：“没有0个参数的重载”再次让我们联想到了类的构造函数。我知道你一定按捺不住想探个究竟，但再此之前，我们需要先把基础知识和应用介绍完。</p><p>既然给委托可以绑定一个方法，那么也应该有办法取消对方法的绑定，很容易想到，这个语法是<code>-=</code>：</p><div class="language-csharp ext-cs line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">GreetingDelegate</span> delegate1 <span class="token operator">=</span> EnglishGreeting<span class="token punctuation">;</span>
    delegate1 <span class="token operator">+=</span> ChineseGreeting<span class="token punctuation">;</span>   <span class="token comment">// 给此委托变量再绑定一个方法</span>

    <span class="token comment">// 将先后调用 EnglishGreeting 与 ChineseGreeting 方法</span>
    <span class="token function">GreetPeople</span><span class="token punctuation">(</span><span class="token string">&quot;Jimmy Zhang&quot;</span><span class="token punctuation">,</span> delegate1<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    delegate1 <span class="token operator">-=</span> EnglishGreeting<span class="token punctuation">;</span> <span class="token comment">//取消对EnglishGreeting方法的绑定</span>
    <span class="token comment">// 将仅调用 ChineseGreeting</span>
    <span class="token function">GreetPeople</span><span class="token punctuation">(</span><span class="token string">&quot;张子阳&quot;</span><span class="token punctuation">,</span> delegate1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    Console<span class="token punctuation">.</span><span class="token function">ReadKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>输出为：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>Morning, Jimmy Zhang
早上好, Jimmy Zhang
早上好, 张子阳
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>让我们再次对委托作个总结：</p><p><strong>使用委托可以将多个方法绑定到同一个委托变量，当调用此变量时(这里用“调用”这个词，是因为此变量代表一个方法)，可以依次调用所有绑定的方法。</strong></p><h2 id="事件的由来" tabindex="-1"><a class="header-anchor" href="#事件的由来" aria-hidden="true">#</a> 事件的由来</h2><p>我们继续思考上面的程序：上面的三个方法都定义在<code>Programe</code>类中，这样做是为了理解的方便，实际应用中，通常都是<code>GreetPeople</code>在一个类中，<code>ChineseGreeting</code>和<code>EnglishGreeting</code>在另外的类中。现在你已经对委托有了初步了解，是时候对上面的例子做个改进了。假设我们将<code>GreetingPeople()</code>放在一个叫<code>GreetingManager</code>的类中，那么新程序应该是这个样子的：</p><div class="language-csharp ext-cs line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">namespace</span> <span class="token namespace">Delegate</span> <span class="token punctuation">{</span>
    <span class="token comment">//定义委托，它定义了可以代表的方法的类型</span>
    <span class="token keyword">public</span> <span class="token keyword">delegate</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">GreetingDelegate</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
   
    <span class="token comment">//新建的GreetingManager类</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GreetingManager</span><span class="token punctuation">{</span>
       <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">GreetPeople</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">,</span> <span class="token class-name">GreetingDelegate</span> MakeGreeting<span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token function">MakeGreeting</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">class</span> <span class="token class-name">Program</span> <span class="token punctuation">{</span>
       <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">EnglishGreeting</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
           Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Morning, &quot;</span> <span class="token operator">+</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>

       <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ChineseGreeting</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
           Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;早上好, &quot;</span> <span class="token operator">+</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>

       <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token comment">// ... ...</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这个时候，如果要实现前面演示的输出效果，Main方法我想应该是这样的：</p><div class="language-csharp ext-cs line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">GreetingManager</span> gm <span class="token operator">=</span> <span class="token keyword">new</span>  <span class="token constructor-invocation class-name">GreetingManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gm<span class="token punctuation">.</span><span class="token function">GreetPeople</span><span class="token punctuation">(</span><span class="token string">&quot;Jimmy Zhang&quot;</span><span class="token punctuation">,</span> EnglishGreeting<span class="token punctuation">)</span><span class="token punctuation">;</span>
    gm<span class="token punctuation">.</span><span class="token function">GreetPeople</span><span class="token punctuation">(</span><span class="token string">&quot;张子阳&quot;</span><span class="token punctuation">,</span> ChineseGreeting<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>我们运行这段代码，嗯，没有任何问题。程序一如预料地那样输出了：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>Morning, Jimmy Zhang
早上好, 张子阳
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>现在，假设我们需要使用上一节学到的知识，将多个方法绑定到同一个委托变量，该如何做呢？让我们再次改写代码：</p><div class="language-csharp ext-cs line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">GreetingManager</span> gm <span class="token operator">=</span> <span class="token keyword">new</span>  <span class="token constructor-invocation class-name">GreetingManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">GreetingDelegate</span> delegate1<span class="token punctuation">;</span>
    delegate1 <span class="token operator">=</span> EnglishGreeting<span class="token punctuation">;</span>
    delegate1 <span class="token operator">+=</span> ChineseGreeting<span class="token punctuation">;</span>

    gm<span class="token punctuation">.</span><span class="token function">GreetPeople</span><span class="token punctuation">(</span><span class="token string">&quot;Jimmy Zhang&quot;</span><span class="token punctuation">,</span> delegate1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>输出：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>Morning, Jimmy Zhang
早上好, Jimmy Zhang
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>到了这里，我们不禁想到：面向对象设计，讲究的是对象的封装，既然可以声明委托类型的变量(在上例中是<code>delegate1</code>)，我们何不将这个变量封装到 <code>GreetManager</code>类中？在这个类的客户端中使用不是更方便么？于是，我们改写<code>GreetManager</code>类，像这样：</p><div class="language-csharp ext-cs line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GreetingManager</span><span class="token punctuation">{</span>
    <span class="token comment">//在GreetingManager类的内部声明delegate1变量</span>
    <span class="token keyword">public</span> <span class="token class-name">GreetingDelegate</span> delegate1<span class="token punctuation">;</span> 

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">GreetPeople</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">,</span> <span class="token class-name">GreetingDelegate</span> MakeGreeting<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token function">MakeGreeting</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>现在，我们可以这样使用这个委托变量：</p><div class="language-csharp ext-cs line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">GreetingManager</span> gm <span class="token operator">=</span> <span class="token keyword">new</span>  <span class="token constructor-invocation class-name">GreetingManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gm<span class="token punctuation">.</span>delegate1 <span class="token operator">=</span> EnglishGreeting<span class="token punctuation">;</span>
    gm<span class="token punctuation">.</span>delegate1 <span class="token operator">+=</span> ChineseGreeting<span class="token punctuation">;</span>

    gm<span class="token punctuation">.</span><span class="token function">GreetPeople</span><span class="token punctuation">(</span><span class="token string">&quot;Jimmy Zhang&quot;</span><span class="token punctuation">,</span> gm<span class="token punctuation">.</span>delegate1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>输出为：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>Morning, Jimmy Zhang
早上好, Jimmy Zhang
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>尽管这样做没有任何问题，但我们发现这条语句很奇怪。在调用<code>gm.GreetPeople</code>方法的时候，再次传递了<code>gm</code>的<code>delegate1</code>字段：</p><div class="language-csharp ext-cs line-numbers-mode"><pre class="language-csharp"><code>gm<span class="token punctuation">.</span><span class="token function">GreetPeople</span><span class="token punctuation">(</span><span class="token string">&quot;Jimmy Zhang&quot;</span><span class="token punctuation">,</span> gm<span class="token punctuation">.</span>delegate1<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>既然如此，我们何不修改<code>GreetingManager</code>类成这样：</p><div class="language-csharp ext-cs line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GreetingManager</span><span class="token punctuation">{</span>
    <span class="token comment">//在GreetingManager类的内部声明delegate1变量</span>
    <span class="token keyword">public</span> <span class="token class-name">GreetingDelegate</span> delegate1<span class="token punctuation">;</span> 

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">GreetPeople</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>delegate1<span class="token operator">!=</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>     <span class="token comment">//如果有方法注册委托变量</span>
          <span class="token function">delegate1</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">//通过委托调用方法</span>
       <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在客户端，调用看上去更简洁一些：</p><div class="language-csharp ext-cs line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">GreetingManager</span> gm <span class="token operator">=</span> <span class="token keyword">new</span>  <span class="token constructor-invocation class-name">GreetingManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gm<span class="token punctuation">.</span>delegate1 <span class="token operator">=</span> EnglishGreeting<span class="token punctuation">;</span>
    gm<span class="token punctuation">.</span>delegate1 <span class="token operator">+=</span> ChineseGreeting<span class="token punctuation">;</span>

    gm<span class="token punctuation">.</span><span class="token function">GreetPeople</span><span class="token punctuation">(</span><span class="token string">&quot;Jimmy Zhang&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">//注意，这次不需要再传递 delegate1变量</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>输出为：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>Morning, Jimmy Zhang
早上好, Jimmy Zhang
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>尽管这样达到了我们要的效果，但是还是存在着问题：</p><p>在这里，<code>delegate1</code>和我们平时用的 string 类型的变量没有什么分别，而我们知道，并不是所有的字段都应该声明成 public，合适的做法是应该 public 的时候 public，应该 private 的时候 private。</p><p>我们先看看如果把<code>delegate1</code>声明为 private 会怎样？结果就是：<strong>这简直就是在搞笑。因为声明委托的目的就是为了把它暴露在类的客户端进行方法的注册，你把它声明为private了，客户端对它根本就不可见，那它还有什么用？</strong></p><p>再看看把<code>delegate1</code>声明为 public 会怎样？结果就是：<strong>在客户端可以对它进行随意的赋值等操作，严重破坏对象的封装性。</strong></p><p>最后，第一个方法注册用“=”，是赋值语法，因为要进行实例化，第二个方法注册则用的是“+=”。但是，不管是赋值还是注册，都是将方法绑定到委托上，除了调用时先后顺序不同，再没有任何的分别，这样不是让人觉得很别扭么？</p><p>现在我们想想，如果<code>delegate1</code>不是一个委托类型，而是一个 string 类型，你会怎么做？答案是：<strong>使用属性对字段进行封装。</strong></p><p>于是，<strong>Event</strong>出场了，它封装了委托类型的变量，使得：<strong>在类的内部，不管你声明它是public还是protected，它总是private的。在类的外部，注册“+=”和注销“-=”的访问限定符与你在声明事件时使用的访问符相同。</strong></p><p>我们改写<code>GreetingManager</code>类，它变成了这个样子：</p><div class="language-csharp ext-cs line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GreetingManager</span><span class="token punctuation">{</span>
    <span class="token comment">//这一次我们在这里声明一个事件</span>
    <span class="token keyword">public</span> <span class="token keyword">event</span> <span class="token class-name">GreetingDelegate</span> MakeGreet<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">GreetPeople</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">MakeGreet</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>很容易注意到：<code>MakeGreet</code>事件的声明与之前委托变量<code>delegate1</code>的声明唯一的区别是多了一个 event 关键字。看到这里，在结合上面的讲解，你应该明白到：事件其实没什么不好理解的，<strong>声明一个事件不过类似于声明一个进行了封装的委托类型的变量而已。</strong></p><p>为了证明上面的推论，如果我们像下面这样改写<code>Main</code>方法：</p><div class="language-csharp ext-cs line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">GreetingManager</span> gm <span class="token operator">=</span> <span class="token keyword">new</span>  <span class="token constructor-invocation class-name">GreetingManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gm<span class="token punctuation">.</span>MakeGreet <span class="token operator">=</span> EnglishGreeting<span class="token punctuation">;</span>         <span class="token comment">// 编译错误1</span>
    gm<span class="token punctuation">.</span>MakeGreet <span class="token operator">+=</span> ChineseGreeting<span class="token punctuation">;</span>

    gm<span class="token punctuation">.</span><span class="token function">GreetPeople</span><span class="token punctuation">(</span><span class="token string">&quot;Jimmy Zhang&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>会得到编译错误：事件“Delegate.GreetingManager.MakeGreet”只能出现在 += 或 -= 的左边(从类型“Delegate.GreetingManager”中使用时除外)。</p><h2 id="事件和委托的编译代码" tabindex="-1"><a class="header-anchor" href="#事件和委托的编译代码" aria-hidden="true">#</a> 事件和委托的编译代码</h2><p>这时候，我们注释掉编译错误的行，然后重新进行编译，再借助 Reflactor 来对 event 的声明语句做一探究，看看为什么会发生这样的错误：</p><div class="language-csharp ext-cs line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">event</span> <span class="token class-name">GreetingDelegate</span> MakeGreet<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>会产生以下的代码：</p><div class="language-csharp ext-cs line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">private</span> <span class="token class-name">GreetingDelegate</span> MakeGreet<span class="token punctuation">;</span> <span class="token comment">//对事件的声明 实际是 声明一个私有的委托变量</span>
 
<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">MethodImpl</span><span class="token attribute-arguments"><span class="token punctuation">(</span>MethodImplOptions<span class="token punctuation">.</span>Synchronized<span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">add_MakeGreet</span><span class="token punctuation">(</span><span class="token class-name">GreetingDelegate</span> <span class="token keyword">value</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>MakeGreet <span class="token operator">=</span> <span class="token punctuation">(</span>GreetingDelegate<span class="token punctuation">)</span> Delegate<span class="token punctuation">.</span><span class="token function">Combine</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>MakeGreet<span class="token punctuation">,</span> <span class="token keyword">value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">MethodImpl</span><span class="token attribute-arguments"><span class="token punctuation">(</span>MethodImplOptions<span class="token punctuation">.</span>Synchronized<span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">remove_MakeGreet</span><span class="token punctuation">(</span><span class="token class-name">GreetingDelegate</span> <span class="token keyword">value</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>MakeGreet <span class="token operator">=</span> <span class="token punctuation">(</span>GreetingDelegate<span class="token punctuation">)</span> Delegate<span class="token punctuation">.</span><span class="token function">Remove</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>MakeGreet<span class="token punctuation">,</span> <span class="token keyword">value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以看到，实际上尽管我们在<code>GreetingManager</code>里将<code>MakeGreet</code>声明为 public，但是，实际上<code>MakeGreet</code>会被编译成私有字段，难怪会发生上面的编译错误了，因为它根本就不允许在<code>GreetingManager</code>类的外面以赋值的方式访问，从而验证了我们上面所做的推论。</p><p>现在已经很明确了：<strong><code>MakeGreet</code>事件确实是一个<code>GreetingDelegate</code>类型的委托，只不过不管是不是声明为 public，它总是被声明为 private。另外，它还有两个方法，分别是<code>add_MakeGreet</code>和<code>remove_MakeGreet</code>，这两个方法分别用于注册委托类型的方法和取消注册。<strong>实际上也就是： “+= ”对应<code>add_MakeGreet</code>，“-=”对应<code>remove_MakeGreet</code>。而</strong>这两个方法的访问限制取决于声明事件时的访问限制符</strong>。</p><p>在<code>add_MakeGreet()</code>方法内部，实际上调用了<code>System.Delegate的Combine()</code>静态方法，这个方法用于将当前的变量添加到委托链表中。我们前面提到过两次，说委托实际上是一个类，在我们定义委托的时候：</p><div class="language-csharp ext-cs line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">delegate</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">GreetingDelegate</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>当编译器遇到这段代码的时候，会生成下面这样一个完整的类：</p><div class="language-csharp ext-cs line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">sealed</span> <span class="token keyword">class</span> <span class="token class-name">GreetingDelegate</span><span class="token punctuation">:</span><span class="token type-list"><span class="token class-name">System<span class="token punctuation">.</span>MulticastDelegate</span></span><span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token function">GreetingDelegate</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> @<span class="token keyword">object</span><span class="token punctuation">,</span> <span class="token class-name">IntPtr</span> method<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">virtual</span> <span class="token return-type class-name">IAsyncResult</span> <span class="token function">BeginInvoke</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">,</span> <span class="token class-name">AsyncCallback</span> callback<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">object</span></span> @<span class="token keyword">object</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">virtual</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">EndInvoke</span><span class="token punctuation">(</span><span class="token class-name">IAsyncResult</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">virtual</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Invoke</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>关于这个类的更深入内容，可以参阅《CLR Via C#》等相关书籍，这里就不再讨论了。</p><h2 id="委托、事件与observer设计模式" tabindex="-1"><a class="header-anchor" href="#委托、事件与observer设计模式" aria-hidden="true">#</a> 委托、事件与Observer设计模式</h2><h3 id="范例说明" tabindex="-1"><a class="header-anchor" href="#范例说明" aria-hidden="true">#</a> 范例说明</h3><p>上面的例子已不足以再进行下面的讲解了，我们来看一个新的范例，因为之前已经介绍了很多的内容，所以本节的进度会稍微快一些：</p><p>假设我们有个高档的热水器，我们给它通上电，当水温超过95度的时候：1、扬声器会开始发出语音，告诉你水的温度；2、液晶屏也会改变水温的显示，来提示水已经快烧开了。</p><p>现在我们需要写个程序来模拟这个烧水的过程，我们将定义一个类来代表热水器，我们管它叫 Heater，它有代表水温的字段，叫做 temperature；当然，还有必不可少的给水加热方法 BoilWater()，一个发出语音警报的方法 MakeAlert()，一个显示水温的方法 ShowMsg()。</p><div class="language-csharp ext-cs line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">namespace</span> <span class="token namespace">Delegate</span> <span class="token punctuation">{</span>
    <span class="token keyword">class</span> <span class="token class-name">Heater</span> <span class="token punctuation">{</span>
        <span class="token keyword">private</span> <span class="token class-name"><span class="token keyword">int</span></span> temperature<span class="token punctuation">;</span> <span class="token comment">// 水温</span>
        <span class="token comment">// 烧水</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">BoilWater</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              temperature <span class="token operator">=</span> i<span class="token punctuation">;</span>

              <span class="token keyword">if</span> <span class="token punctuation">(</span>temperature <span class="token operator">&gt;</span> <span class="token number">95</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  <span class="token function">MakeAlert</span><span class="token punctuation">(</span>temperature<span class="token punctuation">)</span><span class="token punctuation">;</span>
                  <span class="token function">ShowMsg</span><span class="token punctuation">(</span>temperature<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 发出语音警报</span>
        <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">MakeAlert</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> param<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Alarm：嘀嘀嘀，水已经 {0} 度了：&quot;</span> <span class="token punctuation">,</span> param<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      
        <span class="token comment">// 显示水温</span>
        <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ShowMsg</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> param<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Display：水快开了，当前温度：{0}度。&quot;</span> <span class="token punctuation">,</span> param<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">class</span> <span class="token class-name">Program</span> <span class="token punctuation">{</span>
        <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token class-name">Heater</span> ht <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Heater</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          ht<span class="token punctuation">.</span><span class="token function">BoilWater</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="observer设计模式简介" tabindex="-1"><a class="header-anchor" href="#observer设计模式简介" aria-hidden="true">#</a> Observer设计模式简介</h3><p>上面的例子显然能完成我们之前描述的工作，但是却并不够好。现在假设热水器由三部分组成：热水器、警报器、显示器，它们来自于不同厂商并进行了组装。那么，应该是热水器仅仅负责烧水，它不能发出警报也不能显示水温；在水烧开时由警报器发出警报、显示器显示提示和水温。</p><p>这时候，上面的例子就应该变成这个样子：</p><div class="language-csharp ext-cs line-numbers-mode"><pre class="language-csharp"><code><span class="token comment">// 热水器</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Heater</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name"><span class="token keyword">int</span></span> temperature<span class="token punctuation">;</span>
       
    <span class="token comment">// 烧水</span>
    <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">BoilWater</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
           temperature <span class="token operator">=</span> i<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 警报器</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Alarm</span><span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">MakeAlert</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> param<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Alarm：嘀嘀嘀，水已经 {0} 度了：&quot;</span> <span class="token punctuation">,</span> param<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 显示器</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Display</span><span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ShowMsg</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> param<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Display：水已烧开，当前温度：{0}度。&quot;</span> <span class="token punctuation">,</span> param<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这里就出现了一个问题：如何在水烧开的时候通知报警器和显示器？在继续进行之前，我们先了解一下 Observer 设计模式，Observer 设计模式中主要包括如下两类对象：</p><ul><li>Subject：监视对象，它往往包含着其他对象所感兴趣的内容。在本范例中，热水器就是一个监视对象，它包含的其他对象所感兴趣的内容，就是 temprature 字段，当这个字段的值快到100时，会不断把数据发给监视它的对象。</li><li>Observer：监视者，它监视 Subject，当 Subject 中的某件事发生的时候，会告知 Observer，而 Observer 则会采取相应的行动。在本范例中，Observer 有警报器和显示器，它们采取的行动分别是发出警报和显示水温。</li></ul><p>在本例中，事情发生的顺序应该是这样的：</p><ol><li>警报器和显示器告诉热水器，它对它的温度比较感兴趣(注册)。</li><li>热水器知道后保留对警报器和显示器的引用。</li><li>热水器进行烧水这一动作，当水温超过95度时，通过对警报器和显示器的引用，自动调用警报器的<code>MakeAlert()</code>方法、显示器的<code>ShowMsg()</code>方法。</li></ol><p>类似这样的例子是很多的，GOF 对它进行了抽象，称为 Observer 设计模式：<strong>Observer 设计模式是为了定义对象间的一种一对多的依赖关系，以便于当一个对象的状态改变时，其他依赖于它的对象会被自动告知并更新。Observer 模式是一种松耦合的设计模式。</strong></p><h3 id="实现范例的observer设计模式" tabindex="-1"><a class="header-anchor" href="#实现范例的observer设计模式" aria-hidden="true">#</a> 实现范例的Observer设计模式</h3><p>我们之前已经对委托和事件介绍很多了，现在写代码应该很容易了，现在在这里直接给出代码，并在注释中加以说明。</p><div class="language-csharp ext-cs line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Collections<span class="token punctuation">.</span>Generic</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Text</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> <span class="token namespace">Delegate</span> <span class="token punctuation">{</span>
    <span class="token comment">// 热水器</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Heater</span> <span class="token punctuation">{</span>
       <span class="token keyword">private</span> <span class="token class-name"><span class="token keyword">int</span></span> temperature<span class="token punctuation">;</span>
       <span class="token keyword">public</span> <span class="token keyword">delegate</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">BoilHandler</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> param<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//声明委托</span>
       <span class="token keyword">public</span> <span class="token keyword">event</span> <span class="token class-name">BoilHandler</span> BoilEvent<span class="token punctuation">;</span>        <span class="token comment">//声明事件</span>

       <span class="token comment">// 烧水</span>
       <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">BoilWater</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              temperature <span class="token operator">=</span> i<span class="token punctuation">;</span>

              <span class="token keyword">if</span> <span class="token punctuation">(</span>temperature <span class="token operator">&gt;</span> <span class="token number">95</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  <span class="token keyword">if</span> <span class="token punctuation">(</span>BoilEvent <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//如果有对象注册</span>
                      <span class="token function">BoilEvent</span><span class="token punctuation">(</span>temperature<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//调用所有注册对象的方法</span>
                  <span class="token punctuation">}</span>
              <span class="token punctuation">}</span>
           <span class="token punctuation">}</span>
       <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 警报器</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Alarm</span> <span class="token punctuation">{</span>
       <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">MakeAlert</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> param<span class="token punctuation">)</span> <span class="token punctuation">{</span>
           Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Alarm：嘀嘀嘀，水已经 {0} 度了：&quot;</span><span class="token punctuation">,</span> param<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 显示器</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Display</span> <span class="token punctuation">{</span>
       <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ShowMsg</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> param<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//静态方法</span>
           Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Display：水快烧开了，当前温度：{0}度。&quot;</span><span class="token punctuation">,</span> param<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
   
    <span class="token keyword">class</span> <span class="token class-name">Program</span> <span class="token punctuation">{</span>
       <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token class-name">Heater</span> heater <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Heater</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token class-name">Alarm</span> alarm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Alarm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

           heater<span class="token punctuation">.</span>BoilEvent <span class="token operator">+=</span> alarm<span class="token punctuation">.</span>MakeAlert<span class="token punctuation">;</span>    <span class="token comment">//注册方法</span>
           heater<span class="token punctuation">.</span>BoilEvent <span class="token operator">+=</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Alarm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>MakeAlert<span class="token punctuation">;</span>   <span class="token comment">//给匿名对象注册方法</span>
           heater<span class="token punctuation">.</span>BoilEvent <span class="token operator">+=</span> Display<span class="token punctuation">.</span>ShowMsg<span class="token punctuation">;</span>       <span class="token comment">//注册静态方法</span>

           heater<span class="token punctuation">.</span><span class="token function">BoilWater</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//烧水，会自动调用注册过对象的方法</span>
       <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>输出为：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>Alarm：嘀嘀嘀，水已经 <span class="token number">96</span> 度了：
Alarm：嘀嘀嘀，水已经 <span class="token number">96</span> 度了：
Display：水快烧开了，当前温度：96度。
// 省略<span class="token punctuation">..</span>.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="net-framework中的委托与事件" tabindex="-1"><a class="header-anchor" href="#net-framework中的委托与事件" aria-hidden="true">#</a> .Net Framework中的委托与事件</h2><p>尽管上面的范例很好地完成了我们想要完成的工作，但是我们不仅疑惑：为什么 .Net Framework 中的事件模型和上面的不同？为什么有很多的 EventArgs 参数？</p><p>在回答上面的问题之前，我们先搞懂 .Net Framework 的编码规范：</p><ul><li>委托类型的名称都应该以<code>EventHandler</code>结束。</li><li>委托的原型定义：有一个 void 返回值，并接受两个输入参数：一个 Object 类型，一个 EventArgs 类型(或继承自 EventArgs)。</li><li>事件的命名为 委托去掉 EventHandler 之后剩余的部分。</li><li>继承自 EventArgs 的类型应该以 EventArgs 结尾。</li></ul><p>.Net Framework 上面这些其实不仅仅是为了编码规范而已，这样也使得程序有更大的灵活性。比如说，如果我们不光想获得热水器的温度，还想在Observer端(警报器或者显示器)方法中获得它的生产日期、型号、价格，那么委托和方法的声明都会变得很麻烦，而如果我们将热水器的引用传给警报器的方法，就可以在方法中直接访问热水器了。</p><p>现在我们改写之前的范例，让它符合 .Net Framework 的规范：</p><div class="language-csharp ext-cs line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Collections<span class="token punctuation">.</span>Generic</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Text</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> <span class="token namespace">Delegate</span> <span class="token punctuation">{</span>
   <span class="token comment">// 热水器</span>
   <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Heater</span> <span class="token punctuation">{</span>
      <span class="token keyword">private</span> <span class="token class-name"><span class="token keyword">int</span></span> temperature<span class="token punctuation">;</span>
      <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">string</span></span> type <span class="token operator">=</span> <span class="token string">&quot;RealFire 001&quot;</span><span class="token punctuation">;</span>       <span class="token comment">// 添加型号作为演示</span>
      <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">string</span></span> area <span class="token operator">=</span> <span class="token string">&quot;China Xian&quot;</span><span class="token punctuation">;</span>         <span class="token comment">// 添加产地作为演示</span>
      <span class="token comment">//声明委托</span>
      <span class="token keyword">public</span> <span class="token keyword">delegate</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">BoiledEventHandler</span><span class="token punctuation">(</span><span class="token class-name">Object</span> sender<span class="token punctuation">,</span> <span class="token class-name">BoiledEventArgs</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">public</span> <span class="token keyword">event</span> <span class="token class-name">BoiledEventHandler</span> Boiled<span class="token punctuation">;</span> <span class="token comment">//声明事件</span>

      <span class="token comment">// 定义BoiledEventArgs类，传递给Observer所感兴趣的信息</span>
      <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BoiledEventArgs</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">EventArgs</span></span> <span class="token punctuation">{</span>
          <span class="token keyword">public</span> <span class="token keyword">readonly</span> <span class="token class-name"><span class="token keyword">int</span></span> temperature<span class="token punctuation">;</span>
          <span class="token keyword">public</span> <span class="token function">BoiledEventArgs</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> temperature<span class="token punctuation">)</span> <span class="token punctuation">{</span>
             <span class="token keyword">this</span><span class="token punctuation">.</span>temperature <span class="token operator">=</span> temperature<span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>

      <span class="token comment">// 可以供继承自 Heater 的类重写，以便继承类拒绝其他对象对它的监视</span>
      <span class="token keyword">protected</span> <span class="token keyword">virtual</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnBoiled</span><span class="token punctuation">(</span><span class="token class-name">BoiledEventArgs</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>Boiled <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 如果有对象注册</span>
             <span class="token function">Boiled</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 调用所有注册对象的方法</span>
          <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
     
      <span class="token comment">// 烧水。</span>
      <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">BoilWater</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
             temperature <span class="token operator">=</span> i<span class="token punctuation">;</span>
             <span class="token keyword">if</span> <span class="token punctuation">(</span>temperature <span class="token operator">&gt;</span> <span class="token number">95</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                 <span class="token comment">//建立BoiledEventArgs 对象。</span>
                 <span class="token class-name">BoiledEventArgs</span> e <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">BoiledEventArgs</span><span class="token punctuation">(</span>temperature<span class="token punctuation">)</span><span class="token punctuation">;</span>
                 <span class="token function">OnBoiled</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 调用 OnBolied方法</span>
             <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>

   <span class="token comment">// 警报器</span>
   <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Alarm</span> <span class="token punctuation">{</span>
      <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">MakeAlert</span><span class="token punctuation">(</span><span class="token class-name">Object</span> sender<span class="token punctuation">,</span> <span class="token class-name">Heater<span class="token punctuation">.</span>BoiledEventArgs</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token class-name">Heater</span> heater <span class="token operator">=</span> <span class="token punctuation">(</span>Heater<span class="token punctuation">)</span>sender<span class="token punctuation">;</span>     <span class="token comment">//这里是不是很熟悉呢？</span>
          <span class="token comment">//访问 sender 中的公共字段</span>
          Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Alarm：{0} - {1}: &quot;</span><span class="token punctuation">,</span> heater<span class="token punctuation">.</span>area<span class="token punctuation">,</span> heater<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
          Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Alarm: 嘀嘀嘀，水已经 {0} 度了：&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span>temperature<span class="token punctuation">)</span><span class="token punctuation">;</span>
          Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>

   <span class="token comment">// 显示器</span>
   <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Display</span> <span class="token punctuation">{</span>
      <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ShowMsg</span><span class="token punctuation">(</span><span class="token class-name">Object</span> sender<span class="token punctuation">,</span> <span class="token class-name">Heater<span class="token punctuation">.</span>BoiledEventArgs</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>   <span class="token comment">//静态方法</span>
          <span class="token class-name">Heater</span> heater <span class="token operator">=</span> <span class="token punctuation">(</span>Heater<span class="token punctuation">)</span>sender<span class="token punctuation">;</span>
          Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Display：{0} - {1}: &quot;</span><span class="token punctuation">,</span> heater<span class="token punctuation">.</span>area<span class="token punctuation">,</span> heater<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
          Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Display：水快烧开了，当前温度：{0}度。&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span>temperature<span class="token punctuation">)</span><span class="token punctuation">;</span>
          Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">class</span> <span class="token class-name">Program</span> <span class="token punctuation">{</span>
      <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token class-name">Heater</span> heater <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Heater</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token class-name">Alarm</span> alarm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Alarm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

          heater<span class="token punctuation">.</span>Boiled <span class="token operator">+=</span> alarm<span class="token punctuation">.</span>MakeAlert<span class="token punctuation">;</span>   <span class="token comment">//注册方法</span>
          heater<span class="token punctuation">.</span>Boiled <span class="token operator">+=</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Alarm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>MakeAlert<span class="token punctuation">;</span>      <span class="token comment">//给匿名对象注册方法</span>
          heater<span class="token punctuation">.</span>Boiled <span class="token operator">+=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Heater<span class="token punctuation">.</span>BoiledEventHandler</span><span class="token punctuation">(</span>alarm<span class="token punctuation">.</span>MakeAlert<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//也可以这么注册</span>
          heater<span class="token punctuation">.</span>Boiled <span class="token operator">+=</span> Display<span class="token punctuation">.</span>ShowMsg<span class="token punctuation">;</span>       <span class="token comment">//注册静态方法</span>

          heater<span class="token punctuation">.</span><span class="token function">BoilWater</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//烧水，会自动调用注册过对象的方法</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>输出为：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>Alarm：China Xian - RealFire 001:
Alarm: 嘀嘀嘀，水已经 <span class="token number">96</span> 度了：
Alarm：China Xian - RealFire 001:
Alarm: 嘀嘀嘀，水已经 <span class="token number">96</span> 度了：
Alarm：China Xian - RealFire 001:
Alarm: 嘀嘀嘀，水已经 <span class="token number">96</span> 度了：
Display：China Xian - RealFire 001:
Display：水快烧开了，当前温度：96度。
// 省略 <span class="token punctuation">..</span>.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="总结" tabindex="-1"><a class="header-anchor" href="#总结" aria-hidden="true">#</a> 总结</h2><p>在本文中我首先通过一个GreetingPeople的小程序向大家介绍了委托的概念、委托用来做什么，随后又引出了事件，接着对委托与事件所产生的中间代码做了粗略的讲述。</p><p>在第二个稍微复杂点的热水器的范例中，我向大家简要介绍了 Observer设计模式，并通过实现这个范例完成了该模式，随后讲述了.Net Framework中委托、事件的实现方式。</p><p>希望这篇文章能给你带来帮助。</p><h2 id="扩展-unityevent" tabindex="-1"><a class="header-anchor" href="#扩展-unityevent" aria-hidden="true">#</a> 扩展：UnityEvent</h2><p>经过上面的解释，你应该对 C# 的委托（delegate）和事件（event）以及 Observer 设计模式有所了解，那么这一节我们接着讲一讲 Unity 在 Event 的基础上进行的改良，即 UnityEvent。</p><p>Event 设计之初并不会想到应用于 Unity 游戏开发，所以它是纯代码编程的。还是以上面的热水器作为例子，在 Unity 中，热水器 Heater、警报器 Alarm 和显示器 Display 分别是不同的 GameObject，如果我们使用 C# 标准的 Event，那么就需要在 Alarm 和 Display 所挂载的脚本中分别访问 Heater 的 Boiled，然后把自己将采取的行动添加上去。这样有两个坏处：其一是你必须时刻提防订阅的时机，因为订阅的行为是运行时绑定，如果在 Heater 发出消息之后才订阅，那就永远收不到那条消息了；其二是不方便管理，无法直观地看到有哪些对象订阅了 Heater 的 Boiled 事件。</p><p>为了避免上述的缺点，使用 Unity Editor 提高工作效率，Unity 对 Event 进行了改良，UnityEvent 使用 Serializable 让用户可以在 Editor 的 Inspector 窗口中直接绑定所有粉丝的调用，既一目了然又不用担心订阅的时机。</p><p>使用 UnityEvent 对上面热水器的代码进行改造后如下：</p><div class="language-csharp ext-cs line-numbers-mode"><pre class="language-csharp"><code><span class="token comment">// Heater.cs</span>

<span class="token keyword">using</span> <span class="token namespace">UnityEngine</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">UnityEngine<span class="token punctuation">.</span>Events</span><span class="token punctuation">;</span>

<span class="token comment">// 默认的 UnityEvent 是没有参数的，这里需要接收1个参数（温度），所以继承 UnityEvent 的一个参数版本使用自定义类</span>
<span class="token comment">// 使用 Serializable 序列化 Event，使其可以在 Inspector 中显示</span>
<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">System<span class="token punctuation">.</span>Serializable</span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BoilEvent</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">UnityEvent<span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">&gt;</span></span></span>
<span class="token punctuation">{</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Heater</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">MonoBehaviour</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">BoilEvent</span> boiledEvent<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">int</span></span> temperature<span class="token punctuation">;</span>

    <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">BoilWater</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">BoilWater</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            temperature <span class="token operator">=</span> i<span class="token punctuation">;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>temperature <span class="token operator">&gt;</span> <span class="token number">95</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                boiledEvent<span class="token punctuation">?.</span><span class="token function">Invoke</span><span class="token punctuation">(</span>temperature<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//如果有对象注册，调用所有注册对象的方法</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-csharp ext-cs line-numbers-mode"><pre class="language-csharp"><code><span class="token comment">// Alarm.cs</span>

<span class="token keyword">using</span> <span class="token namespace">UnityEngine</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Alarm</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">MonoBehaviour</span></span>
<span class="token punctuation">{</span>
    <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">MakeAlert</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> param<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Debug<span class="token punctuation">.</span><span class="token function">Log</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;Alarm：嘀嘀嘀，水已经 </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">param</span><span class="token punctuation">}</span></span><span class="token string"> 度了。&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-csharp ext-cs line-numbers-mode"><pre class="language-csharp"><code><span class="token comment">// Display.cs</span>

<span class="token keyword">using</span> <span class="token namespace">UnityEngine</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Display</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">MonoBehaviour</span></span>
<span class="token punctuation">{</span>
    <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ShowMsg</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> param<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Debug<span class="token punctuation">.</span><span class="token function">Log</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;Display：水快烧开了，当前温度：</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">param</span><span class="token punctuation">}</span></span><span class="token string">度。&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>把上面三个脚本绑定到三个 GameObject 上，在 Heater 的 Inspector 面板中看到 boiledEvent 可以设置回调对象。点击 + 号添加回调对象，然后选择回调的 GameObject 和方法（在本例中，分别为<code>Alarm.MakeAlert</code>和<code>Display.ShowMsg</code>），然后再运行游戏，就可以得到和基于 delegate 的 Event 方法相同的效果。</p><p>除了在 Editor 中提前绑定订阅者外，UnityEvent 也支持和 C# Event 类似的运行时绑定，不过由于 UnityEvent 是一个对象，向其添加或取消订阅函数要通过<code>AddListener()</code>和<code>RemoveListener()</code>来完成。</p></div><!----><footer class="page-meta"><!----><div class="meta-item update-time"><span class="label">上次编辑于: </span><span class="info">2022/9/15 07:58:15</span></div><div class="meta-item contributors"><span class="label">贡献者: </span><!--[--><!--[--><span class="contributor" title="email: py_wing@qq.com">WingSnow</span><!--]--><!--]--></div></footer><nav class="page-nav"><a href="/wingsnow-blog/code/unity/3-unity%E7%9A%84%E6%97%B6%E9%97%B4%E9%80%BB%E8%BE%91.html" class="nav-link prev" aria-label="Unity 的时间逻辑"><div class="hint"><span class="arrow left"></span>上一页</div><div class="link"><!---->Unity 的时间逻辑</div></a><a href="/wingsnow-blog/code/unity/5-unity%E7%9A%84%E9%9A%8F%E6%9C%BA%E6%95%B0.html" class="nav-link next" aria-label="Unity 的随机数"><div class="hint">下一页<span class="arrow right"></span></div><div class="link">Unity 的随机数<!----></div></a></nav><!----><!----><!--]--></main><!--]--><footer class="footer-wrapper"><div class="footer"></div><!----></footer><!--]--></div><!--]--><!----><!--]--></div>
    <script type="module" src="/wingsnow-blog/assets/app.b12f069c.js" defer></script>
  </body>
</html>
