<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.49" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://wingsnow.github.io/wingsnow-blog/wingsnow-blog/code/javascript/4-%E4%BD%BF%E7%94%A8koa2%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BA%E6%8E%A5%E5%8F%A3%E6%9C%8D%E5%8A%A1%E5%99%A8.html"><meta property="og:site_name" content="冬天吃雪糕的博客"><meta property="og:title" content="使用 koa2 快速搭建接口服务器"><meta property="og:description" content="本文介绍如何使用 koa 快速搭建一个接口服务器。"><meta property="og:type" content="article"><meta property="og:updated_time" content="2022-08-23T06:32:29.000Z"><meta property="og:locale" content="zh-CN"><meta property="article:tag" content="Web"><meta property="article:tag" content="Javascript"><meta property="article:tag" content="Koa"><meta property="article:tag" content="NodeJS"><meta property="article:published_time" content="2022-06-15T00:00:00.000Z"><meta property="article:modified_time" content="2022-08-23T06:32:29.000Z"><link rel="icon" href="./favicon.ico"><title>使用 koa2 快速搭建接口服务器 | 冬天吃雪糕的博客</title><meta name="description" content="本文介绍如何使用 koa 快速搭建一个接口服务器。">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d2025;
      }

      html,
      body {
        background-color: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="stylesheet" href="/wingsnow-blog/assets/style.acb67ab8.css">
    <link rel="modulepreload" href="/wingsnow-blog/assets/app.b12f069c.js"><link rel="modulepreload" href="/wingsnow-blog/assets/4-使用koa2快速搭建接口服务器.html.3b475ed8.js"><link rel="modulepreload" href="/wingsnow-blog/assets/plugin-vue_export-helper.21dcd24c.js"><link rel="modulepreload" href="/wingsnow-blog/assets/4-使用koa2快速搭建接口服务器.html.70e9b656.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.0d7faed9.js"><link rel="prefetch" href="/wingsnow-blog/assets/note.html.bd61cbd3.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.2d29783e.js"><link rel="prefetch" href="/wingsnow-blog/assets/1-fetch异常处理.html.60568ec6.js"><link rel="prefetch" href="/wingsnow-blog/assets/2-linter配置指南.html.8d59b555.js"><link rel="prefetch" href="/wingsnow-blog/assets/3-foreach、map、reduce和promise.html.c016c5b6.js"><link rel="prefetch" href="/wingsnow-blog/assets/5-package.json使用指南.html.0161d3da.js"><link rel="prefetch" href="/wingsnow-blog/assets/6-SemVer语义化版本规范.html.0b80ad55.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.d962c886.js"><link rel="prefetch" href="/wingsnow-blog/assets/1-VMware安装Ubuntu.html.252e3ca4.js"><link rel="prefetch" href="/wingsnow-blog/assets/2- 配置node环境.html.8493f9e0.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.3422fec8.js"><link rel="prefetch" href="/wingsnow-blog/assets/1-mathf库介绍.html.97bdedcc.js"><link rel="prefetch" href="/wingsnow-blog/assets/10-数据容器ScriptableObject.html.41fcd6a0.js"><link rel="prefetch" href="/wingsnow-blog/assets/11-Awake和Start的区别.html.05ba5f8e.js"><link rel="prefetch" href="/wingsnow-blog/assets/12-unity实现物体沿曲线运动.html.db037910.js"><link rel="prefetch" href="/wingsnow-blog/assets/13-unity读取xml文件.html.5bb74923.js"><link rel="prefetch" href="/wingsnow-blog/assets/2-浅谈unity中的各种移动.html.12ce8ebb.js"><link rel="prefetch" href="/wingsnow-blog/assets/3-unity的时间逻辑.html.ac476a1d.js"><link rel="prefetch" href="/wingsnow-blog/assets/4-委托和事件详解.html.15eb09b2.js"><link rel="prefetch" href="/wingsnow-blog/assets/5-unity的随机数.html.ff092862.js"><link rel="prefetch" href="/wingsnow-blog/assets/6-unity延时调用.html.22815904.js"><link rel="prefetch" href="/wingsnow-blog/assets/7-跟随鼠标移动.html.b1672313.js"><link rel="prefetch" href="/wingsnow-blog/assets/8-获取游戏对象的包围盒.html.585540af.js"><link rel="prefetch" href="/wingsnow-blog/assets/9-判断物体是否在屏幕内.html.ea74e8fb.js"><link rel="prefetch" href="/wingsnow-blog/assets/99-(todo)Unity编辑器扩展基础.html.faa761da.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.18736f50.js"><link rel="prefetch" href="/wingsnow-blog/assets/1-vue3组件间通信.html.ff5ae590.js"><link rel="prefetch" href="/wingsnow-blog/assets/2-在VSCode添加代码片段.html.9fb050ad.js"><link rel="prefetch" href="/wingsnow-blog/assets/3-vite使用cdn加载库文件.html.df10fff6.js"><link rel="prefetch" href="/wingsnow-blog/assets/4-vue批量导入静态资源.html.4f1db67c.js"><link rel="prefetch" href="/wingsnow-blog/assets/5-vue插件开发.html.19a24390.js"><link rel="prefetch" href="/wingsnow-blog/assets/6-vue 组件带类型推断的 ref 写法.html.adabe50f.js"><link rel="prefetch" href="/wingsnow-blog/assets/7-vite使用ionicons.html.94c74684.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.197b9930.js"><link rel="prefetch" href="/wingsnow-blog/assets/1-做个骰子.html.8a12ccf7.js"><link rel="prefetch" href="/wingsnow-blog/assets/2-自定义消息框.html.b6ff1fec.js"><link rel="prefetch" href="/wingsnow-blog/assets/3-打字机效果文本.html.2bab1316.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.e4e35a98.js"><link rel="prefetch" href="/wingsnow-blog/assets/404.html.e2d88369.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.4f451601.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.b107328c.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.b0c70922.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.2a2a7491.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.68cb95a1.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.fff82f3c.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.a33ec080.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.3df0f7cf.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.9c295e9b.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.7add276b.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.ced706f9.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.10e4e043.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.6ed032f5.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.fcc77962.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.178e98d6.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.c207471d.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.4602bb9c.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.2bf4253c.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.3d3a5208.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.e8da1159.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.d52e1e1c.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.231dfdb9.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.9e40d108.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.b3201650.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.0d1cd9fd.js"><link rel="prefetch" href="/wingsnow-blog/assets/note.html.7e512c5b.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.1394e8d9.js"><link rel="prefetch" href="/wingsnow-blog/assets/1-fetch异常处理.html.0daac437.js"><link rel="prefetch" href="/wingsnow-blog/assets/2-linter配置指南.html.5a1fa538.js"><link rel="prefetch" href="/wingsnow-blog/assets/3-foreach、map、reduce和promise.html.d10b1eed.js"><link rel="prefetch" href="/wingsnow-blog/assets/5-package.json使用指南.html.fe1b110c.js"><link rel="prefetch" href="/wingsnow-blog/assets/6-SemVer语义化版本规范.html.b305a8dd.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.24e2f177.js"><link rel="prefetch" href="/wingsnow-blog/assets/1-VMware安装Ubuntu.html.48a7ce2e.js"><link rel="prefetch" href="/wingsnow-blog/assets/2- 配置node环境.html.0cdf6b7b.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.496d67f2.js"><link rel="prefetch" href="/wingsnow-blog/assets/1-mathf库介绍.html.b75087e3.js"><link rel="prefetch" href="/wingsnow-blog/assets/10-数据容器ScriptableObject.html.9042bdad.js"><link rel="prefetch" href="/wingsnow-blog/assets/11-Awake和Start的区别.html.3ec524b5.js"><link rel="prefetch" href="/wingsnow-blog/assets/12-unity实现物体沿曲线运动.html.a7a4266d.js"><link rel="prefetch" href="/wingsnow-blog/assets/13-unity读取xml文件.html.4ec325d4.js"><link rel="prefetch" href="/wingsnow-blog/assets/2-浅谈unity中的各种移动.html.b44930fd.js"><link rel="prefetch" href="/wingsnow-blog/assets/3-unity的时间逻辑.html.3ba57cc5.js"><link rel="prefetch" href="/wingsnow-blog/assets/4-委托和事件详解.html.b159739c.js"><link rel="prefetch" href="/wingsnow-blog/assets/5-unity的随机数.html.1127acb7.js"><link rel="prefetch" href="/wingsnow-blog/assets/6-unity延时调用.html.93273209.js"><link rel="prefetch" href="/wingsnow-blog/assets/7-跟随鼠标移动.html.4508dc81.js"><link rel="prefetch" href="/wingsnow-blog/assets/8-获取游戏对象的包围盒.html.e026f250.js"><link rel="prefetch" href="/wingsnow-blog/assets/9-判断物体是否在屏幕内.html.fcf8b0f3.js"><link rel="prefetch" href="/wingsnow-blog/assets/99-(todo)Unity编辑器扩展基础.html.ef167244.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.e691527a.js"><link rel="prefetch" href="/wingsnow-blog/assets/1-vue3组件间通信.html.5a52f0d3.js"><link rel="prefetch" href="/wingsnow-blog/assets/2-在VSCode添加代码片段.html.1370ae05.js"><link rel="prefetch" href="/wingsnow-blog/assets/3-vite使用cdn加载库文件.html.297ac413.js"><link rel="prefetch" href="/wingsnow-blog/assets/4-vue批量导入静态资源.html.03b1bbe3.js"><link rel="prefetch" href="/wingsnow-blog/assets/5-vue插件开发.html.efa5627a.js"><link rel="prefetch" href="/wingsnow-blog/assets/6-vue 组件带类型推断的 ref 写法.html.d0465d07.js"><link rel="prefetch" href="/wingsnow-blog/assets/7-vite使用ionicons.html.fae100db.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.8e51b620.js"><link rel="prefetch" href="/wingsnow-blog/assets/1-做个骰子.html.942d0c94.js"><link rel="prefetch" href="/wingsnow-blog/assets/2-自定义消息框.html.97a2831a.js"><link rel="prefetch" href="/wingsnow-blog/assets/3-打字机效果文本.html.cdba656e.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.b560b847.js"><link rel="prefetch" href="/wingsnow-blog/assets/404.html.73c00f42.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.d10869ab.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.1beede3d.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.154f0b2b.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.3ece323f.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.c59955ef.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.6c0845ee.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.1a198940.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.fe476996.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.3ade2c91.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.5f594081.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.f6c14e5e.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.35e7b02b.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.af762fb6.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.bbf4d183.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.e780d860.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.960ee360.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.3b269095.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.603a7e51.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.fbaaceb5.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.bb225357.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.393fa7dc.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.4a5f28c7.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.fa0b92e2.js"><link rel="prefetch" href="/wingsnow-blog/assets/index.html.b77992f2.js"><link rel="prefetch" href="/wingsnow-blog/assets/404.6c991f4c.js"><link rel="prefetch" href="/wingsnow-blog/assets/Layout.31cd7643.js"><link rel="prefetch" href="/wingsnow-blog/assets/Blog.e850ff1f.js"><link rel="prefetch" href="/wingsnow-blog/assets/photoswipe.esm.03eca607.js"><link rel="prefetch" href="/wingsnow-blog/assets/CustomButton.ae438941.js"><link rel="prefetch" href="/wingsnow-blog/assets/Dice.1064797f.js"><link rel="prefetch" href="/wingsnow-blog/assets/PopAlter.6a63e8f2.js"><link rel="prefetch" href="/wingsnow-blog/assets/TyperText.9dc62f22.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">Skip to content</a><!--]--><div class="theme-container has-toc"><!--[--><!--[--><header class="navbar"><div class="navbar-left"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><a href="/wingsnow-blog/" class="brand"><img class="logo" src="/wingsnow-blog/logo.png" alt="冬天吃雪糕的博客"><!----><span class="site-name hide-in-pad">冬天吃雪糕的博客</span></a><!----></div><div class="navbar-center"><!----><nav class="nav-links"><div class="nav-item hide-in-mobile"><a href="/wingsnow-blog/" class="nav-link" aria-label="博客主页"><span class="icon iconfont icon-home"></span>博客主页<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="代码笔记"><span class="title"><span class="icon iconfont icon-code"></span>代码笔记</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>Web前端</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/wingsnow-blog/code/vue/" class="nav-link" aria-label="Vue笔记"><span class="icon iconfont icon-vue"></span>Vue笔记<!----></a></li><li class="dropdown-subitem"><a href="/wingsnow-blog/code/javascript/" class="nav-link active" aria-label="JavaScript笔记"><span class="icon iconfont icon-javascript"></span>JavaScript笔记<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>游戏开发</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/wingsnow-blog/code/unity/" class="nav-link" aria-label="Unity笔记"><span class="icon iconfont icon-view"></span>Unity笔记<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>后端运维</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/wingsnow-blog/code/ubuntu/" class="nav-link" aria-label="Ubuntu笔记"><span class="icon iconfont icon-ubuntu"></span>Ubuntu笔记<!----></a></li></ul></li><li class="dropdown-item"><a href="/wingsnow-blog/code/note.html" class="nav-link" aria-label="代码小记"><!---->代码小记<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="项目"><span class="title"><span class="icon iconfont icon-module"></span>项目</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/wingsnow-blog/projects/vueComponents/" class="nav-link" aria-label="Vue组件"><span class="icon iconfont icon-vue"></span>Vue组件<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><a href="/wingsnow-blog/design/" class="nav-link" aria-label="产品设计"><span class="icon iconfont icon-palette"></span>产品设计<!----></a></div></nav><!----></div><div class="navbar-right"><!----><!----><!----><div class="nav-item hide-in-mobile"><button id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!----><!----><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow left"></span></div><aside class="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable active"><span class="icon iconfont icon-javascript"></span><span class="title">Javascript笔记</span><span class="arrow down"></span></button><ul class="sidebar-links"><li><!--[--><a href="/wingsnow-blog/code/javascript/1-fetch%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86.html" class="nav-link sidebar-link sidebar-page" aria-label="fetch 异常处理"><!---->fetch 异常处理<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/wingsnow-blog/code/javascript/2-linter%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97.html" class="nav-link sidebar-link sidebar-page" aria-label="Linter 配置指南"><!---->Linter 配置指南<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/wingsnow-blog/code/javascript/3-foreach%E3%80%81map%E3%80%81reduce%E5%92%8Cpromise.html" class="nav-link sidebar-link sidebar-page" aria-label="forEach、map、reduce和Promise"><!---->forEach、map、reduce和Promise<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-current="page" href="/wingsnow-blog/code/javascript/4-%E4%BD%BF%E7%94%A8koa2%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BA%E6%8E%A5%E5%8F%A3%E6%9C%8D%E5%8A%A1%E5%99%A8.html" class="router-link-active router-link-exact-active nav-link active sidebar-link sidebar-page active" aria-label="使用 koa2 快速搭建接口服务器"><!---->使用 koa2 快速搭建接口服务器<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/wingsnow-blog/code/javascript/4-%E4%BD%BF%E7%94%A8koa2%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BA%E6%8E%A5%E5%8F%A3%E6%9C%8D%E5%8A%A1%E5%99%A8.html#使用-koa-generator" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="使用 koa-generator"><!---->使用 koa-generator<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/wingsnow-blog/code/javascript/4-%E4%BD%BF%E7%94%A8koa2%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BA%E6%8E%A5%E5%8F%A3%E6%9C%8D%E5%8A%A1%E5%99%A8.html#安装-koa-generator" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="安装 koa-generator"><!---->安装 koa-generator<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/wingsnow-blog/code/javascript/4-%E4%BD%BF%E7%94%A8koa2%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BA%E6%8E%A5%E5%8F%A3%E6%9C%8D%E5%8A%A1%E5%99%A8.html#创建项目" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="创建项目"><!---->创建项目<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/wingsnow-blog/code/javascript/4-%E4%BD%BF%E7%94%A8koa2%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BA%E6%8E%A5%E5%8F%A3%E6%9C%8D%E5%8A%A1%E5%99%A8.html#运行项目" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="运行项目"><!---->运行项目<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/wingsnow-blog/code/javascript/4-%E4%BD%BF%E7%94%A8koa2%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BA%E6%8E%A5%E5%8F%A3%E6%9C%8D%E5%8A%A1%E5%99%A8.html#手工搭建" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="手工搭建"><!---->手工搭建<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/wingsnow-blog/code/javascript/4-%E4%BD%BF%E7%94%A8koa2%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BA%E6%8E%A5%E5%8F%A3%E6%9C%8D%E5%8A%A1%E5%99%A8.html#创建项目-1" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="创建项目"><!---->创建项目<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/wingsnow-blog/code/javascript/4-%E4%BD%BF%E7%94%A8koa2%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BA%E6%8E%A5%E5%8F%A3%E6%9C%8D%E5%8A%A1%E5%99%A8.html#安装依赖" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="安装依赖"><!---->安装依赖<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/wingsnow-blog/code/javascript/4-%E4%BD%BF%E7%94%A8koa2%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BA%E6%8E%A5%E5%8F%A3%E6%9C%8D%E5%8A%A1%E5%99%A8.html#从-hello-world-开始" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="从 Hello World 开始"><!---->从 Hello World 开始<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/wingsnow-blog/code/javascript/4-%E4%BD%BF%E7%94%A8koa2%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BA%E6%8E%A5%E5%8F%A3%E6%9C%8D%E5%8A%A1%E5%99%A8.html#路由" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="路由"><!---->路由<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/wingsnow-blog/code/javascript/4-%E4%BD%BF%E7%94%A8koa2%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BA%E6%8E%A5%E5%8F%A3%E6%9C%8D%E5%8A%A1%E5%99%A8.html#渲染模板" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="渲染模板"><!---->渲染模板<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/wingsnow-blog/code/javascript/4-%E4%BD%BF%E7%94%A8koa2%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BA%E6%8E%A5%E5%8F%A3%E6%9C%8D%E5%8A%A1%E5%99%A8.html#静态文件" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="静态文件"><!---->静态文件<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/wingsnow-blog/code/javascript/4-%E4%BD%BF%E7%94%A8koa2%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BA%E6%8E%A5%E5%8F%A3%E6%9C%8D%E5%8A%A1%E5%99%A8.html#处理请求" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="处理请求"><!---->处理请求<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/wingsnow-blog/code/javascript/4-%E4%BD%BF%E7%94%A8koa2%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BA%E6%8E%A5%E5%8F%A3%E6%9C%8D%E5%8A%A1%E5%99%A8.html#热更新" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="热更新"><!---->热更新<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li></ul><!--]--></li><li><!--[--><a href="/wingsnow-blog/code/javascript/5-package.json%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97.html" class="nav-link sidebar-link sidebar-page" aria-label="package.json 使用指南"><!---->package.json 使用指南<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/wingsnow-blog/code/javascript/6-SemVer%E8%AF%AD%E4%B9%89%E5%8C%96%E7%89%88%E6%9C%AC%E8%A7%84%E8%8C%83.html" class="nav-link sidebar-link sidebar-page" aria-label="SemVer 语义化版本规范"><!---->SemVer 语义化版本规范<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-ubuntu"></span><span class="title">Ubuntu笔记</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-view"></span><span class="title">Unity笔记</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-vue"></span><span class="title">Vue笔记</span><span class="arrow right"></span></button><!----></section><!--]--></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->使用 koa2 快速搭建接口服务器</h1><div class="page-info"><span class="author-info" aria-label="作者🖊" data-balloon-pos="down" localizeddate="2022年6月15日" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="author-item" href="http://www.wingsnow.cn" target="_blank" rel="noopener noreferrer">冬天吃雪糕</a></span><span property="author" content="冬天吃雪糕"></span></span><!----><span class="date-info" aria-label="写作日期📅" data-balloon-pos="down" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span>2022年6月15日</span><meta property="datePublished" content="2022-06-15T00:00:00.000Z"></span><span class="category-info" aria-label="分类🌈" data-balloon-pos="down" localizeddate="2022年6月15日" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="category icon"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><ul class="categories-wrapper"><li class="category category2 clickable" role="navigation">代码笔记</li><li class="category category8 clickable" role="navigation">Javascript笔记</li><meta property="articleSection" content="代码笔记,Javascript笔记"></ul></span><span aria-label="标签🏷" data-balloon-pos="down" localizeddate="2022年6月15日" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="tag icon"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><ul class="tags-wrapper"><li class="tag tag1 clickable" role="navigation">Web</li><li class="tag tag2 clickable" role="navigation">Javascript</li><li class="tag tag8 clickable" role="navigation">Koa</li><li class="tag tag3 clickable" role="navigation">NodeJS</li></ul><meta property="keywords" content="Web,Javascript,Koa,NodeJS"></span><span class="reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="down" localizeddate="2022年6月15日" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 12 分钟</span><meta property="timeRequired" content="PT12M"></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><div class="toc-header">此页内容</div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/wingsnow-blog/code/javascript/4-%E4%BD%BF%E7%94%A8koa2%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BA%E6%8E%A5%E5%8F%A3%E6%9C%8D%E5%8A%A1%E5%99%A8.html#使用-koa-generator" class="router-link-active router-link-exact-active toc-link level2">使用 koa-generator</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/wingsnow-blog/code/javascript/4-%E4%BD%BF%E7%94%A8koa2%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BA%E6%8E%A5%E5%8F%A3%E6%9C%8D%E5%8A%A1%E5%99%A8.html#安装-koa-generator" class="router-link-active router-link-exact-active toc-link level3">安装 koa-generator</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/wingsnow-blog/code/javascript/4-%E4%BD%BF%E7%94%A8koa2%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BA%E6%8E%A5%E5%8F%A3%E6%9C%8D%E5%8A%A1%E5%99%A8.html#创建项目" class="router-link-active router-link-exact-active toc-link level3">创建项目</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/wingsnow-blog/code/javascript/4-%E4%BD%BF%E7%94%A8koa2%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BA%E6%8E%A5%E5%8F%A3%E6%9C%8D%E5%8A%A1%E5%99%A8.html#运行项目" class="router-link-active router-link-exact-active toc-link level3">运行项目</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/wingsnow-blog/code/javascript/4-%E4%BD%BF%E7%94%A8koa2%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BA%E6%8E%A5%E5%8F%A3%E6%9C%8D%E5%8A%A1%E5%99%A8.html#手工搭建" class="router-link-active router-link-exact-active toc-link level2">手工搭建</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/wingsnow-blog/code/javascript/4-%E4%BD%BF%E7%94%A8koa2%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BA%E6%8E%A5%E5%8F%A3%E6%9C%8D%E5%8A%A1%E5%99%A8.html#创建项目-1" class="router-link-active router-link-exact-active toc-link level3">创建项目</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/wingsnow-blog/code/javascript/4-%E4%BD%BF%E7%94%A8koa2%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BA%E6%8E%A5%E5%8F%A3%E6%9C%8D%E5%8A%A1%E5%99%A8.html#安装依赖" class="router-link-active router-link-exact-active toc-link level3">安装依赖</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/wingsnow-blog/code/javascript/4-%E4%BD%BF%E7%94%A8koa2%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BA%E6%8E%A5%E5%8F%A3%E6%9C%8D%E5%8A%A1%E5%99%A8.html#从-hello-world-开始" class="router-link-active router-link-exact-active toc-link level3">从 Hello World 开始</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/wingsnow-blog/code/javascript/4-%E4%BD%BF%E7%94%A8koa2%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BA%E6%8E%A5%E5%8F%A3%E6%9C%8D%E5%8A%A1%E5%99%A8.html#路由" class="router-link-active router-link-exact-active toc-link level3">路由</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/wingsnow-blog/code/javascript/4-%E4%BD%BF%E7%94%A8koa2%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BA%E6%8E%A5%E5%8F%A3%E6%9C%8D%E5%8A%A1%E5%99%A8.html#渲染模板" class="router-link-active router-link-exact-active toc-link level3">渲染模板</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/wingsnow-blog/code/javascript/4-%E4%BD%BF%E7%94%A8koa2%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BA%E6%8E%A5%E5%8F%A3%E6%9C%8D%E5%8A%A1%E5%99%A8.html#静态文件" class="router-link-active router-link-exact-active toc-link level3">静态文件</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/wingsnow-blog/code/javascript/4-%E4%BD%BF%E7%94%A8koa2%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BA%E6%8E%A5%E5%8F%A3%E6%9C%8D%E5%8A%A1%E5%99%A8.html#处理请求" class="router-link-active router-link-exact-active toc-link level3">处理请求</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/wingsnow-blog/code/javascript/4-%E4%BD%BF%E7%94%A8koa2%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BA%E6%8E%A5%E5%8F%A3%E6%9C%8D%E5%8A%A1%E5%99%A8.html#热更新" class="router-link-active router-link-exact-active toc-link level3">热更新</a></li><!----><!--]--></ul><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><h1 id="使用-koa2-快速搭建接口服务器" tabindex="-1"><a class="header-anchor" href="#使用-koa2-快速搭建接口服务器" aria-hidden="true">#</a> 使用 koa2 快速搭建接口服务器</h1><h2 id="使用-koa-generator" tabindex="-1"><a class="header-anchor" href="#使用-koa-generator" aria-hidden="true">#</a> 使用 koa-generator</h2><p>koa2提供了一个生成器<code>koa-generator</code>，用于生成一个项目脚手架，方便开箱即用。</p><ul><li>约定目录结构</li><li>集成一些基础的、必要的中间件</li><li>app.js作为入口文件</li><li>bin/www作为启动入口</li><li>支持静态服务器</li><li>支持routes路由目录</li><li>支持views视图目录，默认pug作为模板引擎</li></ul><h3 id="安装-koa-generator" tabindex="-1"><a class="header-anchor" href="#安装-koa-generator" aria-hidden="true">#</a> 安装 koa-generator</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">pnpm</span> i -g koa-generator
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="创建项目" tabindex="-1"><a class="header-anchor" href="#创建项目" aria-hidden="true">#</a> 创建项目</h3><p>koa-generator 支持 Koa1.x 和 2.x，分别使用<code>koa</code>和<code>koa2</code>创建。</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>koa2 koa-init
<span class="token builtin class-name">cd</span> koa-init
<span class="token function">pnpm</span> i
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>koa-generator 会自动生成如下目录结构</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>├───app.js
├───package.json
├───bin
│   └───www
├───public
│   ├───images
│   ├───javascripts
│   └───stylesheets
│       └───style.css
├───routes
│   ├───index.js
│   └───users.js
└───views
    ├───error.pug
    ├───index.pug
    └───layout.pug
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>其中的 package.json 内容及解释如下：</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;koa-init&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;0.1.0&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;private&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node bin/www&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 代码变动需要重启node进程</span>
    <span class="token property">&quot;dev&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./node_modules/.bin/nodemon bin/www&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 代码变动，通过nodemon自动重启node进程</span>
    <span class="token property">&quot;prd&quot;</span><span class="token operator">:</span> <span class="token string">&quot;pm2 start bin/www&quot;</span><span class="token punctuation">,</span><span class="token comment">// 生产环境 pm2启动</span>
    <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;dependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;debug&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^4.1.1&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 根据Debug环境变量输出调试日志</span>
    <span class="token property">&quot;koa&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^2.7.0&quot;</span><span class="token punctuation">,</span> 
    <span class="token property">&quot;koa-bodyparser&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^4.2.1&quot;</span><span class="token punctuation">,</span><span class="token comment">// 解析body，主要针对post请求</span>
    <span class="token property">&quot;koa-convert&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^1.2.0&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 兼容Koa2中间件写法</span>
    <span class="token property">&quot;koa-json&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^2.0.2&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 对json更好对的支持</span>
    <span class="token property">&quot;koa-logger&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^3.2.0&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 开发阶段的日志模块</span>
    <span class="token property">&quot;koa-onerror&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^4.1.0&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 错误处理模块</span>
    <span class="token property">&quot;koa-router&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^7.4.0&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 路由</span>
    <span class="token property">&quot;koa-static&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^5.0.0&quot;</span><span class="token punctuation">,</span> <span class="token comment">// HTTP静态服务器</span>
    <span class="token property">&quot;koa-views&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^6.2.0&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 视图渲染</span>
    <span class="token property">&quot;pug&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^2.0.3&quot;</span> <span class="token comment">// 模板引擎</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;devDependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;nodemon&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^1.19.1&quot;</span> <span class="token comment">// 自动重启node进程</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><details class="custom-container details"><summary>安装过程中的 deprecated 警告</summary><p><code>koa-generator</code>的最新版本为 1.1.7 ，最后一次更新日期为3年前，因此很多包的依赖版本都已经过时了。</p><p>建议使用<code>koa-generator</code>学习各个中间件的功能以及基本用法，在自己的项目中按需裁剪。</p></details><h3 id="运行项目" tabindex="-1"><a class="header-anchor" href="#运行项目" aria-hidden="true">#</a> 运行项目</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">pnpm</span> start
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>分别使用浏览器或接口调用工具（例如 postman ）访问<code>localhost:3000</code>，<code>localhost:3000/string</code>，<code>localhost:3000/json</code>，<code>localhost:3000/users</code>，<code>localhost:3000/users/bar</code>，查看显示或返回结果。</p><p>如果要修改返回的内容，可以修改 routes 目录下的文件，例如在 routes/users.js 中增加一个延时3秒返回的接口。</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// routes/users.js</span>

<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;koa-router&#39;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

router<span class="token punctuation">.</span><span class="token function">prefix</span><span class="token punctuation">(</span><span class="token string">&#39;/users&#39;</span><span class="token punctuation">)</span>

router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;/&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">&#39;this is a users response!&#39;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;/bar&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">&#39;this is a users/bar response&#39;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;/foo&#39;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">&#39;this is a users/foo response delay 3000ms&#39;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> router
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="custom-container tip"><p class="custom-container-title">提示</p><p>如果是使用<code>pnpm start</code>命令运行项目的，修改后需要重新运行程序才会生效；<code>koa-generator</code>也集成了<code>nodemon</code>实现热更新，对应的启动项目命令为<code>pnpm dev</code>。</p><p>顺带一提，自动生成的<code>dev</code>脚本为<code>./node_modules/.bin/nodemon bin/www</code>。实际上由于在执行 npm script 时<code>./node_modules/.bin/</code>会自动添加到环境的 PATH 变量，所以可以简写成<code>nodemon bin/www</code>。</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  ...
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node bin/www&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;dev&quot;</span><span class="token operator">:</span> <span class="token string">&quot;nodemon bin/www&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;prd&quot;</span><span class="token operator">:</span> <span class="token string">&quot;pm2 start bin/www&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  ...
<span class="token punctuation">}</span>
</code></pre><div class="highlight-lines"><br><br><br><br><div class="highlight-line"> </div><br><br><br><br><br></div><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><h2 id="手工搭建" tabindex="-1"><a class="header-anchor" href="#手工搭建" aria-hidden="true">#</a> 手工搭建</h2><p>前文提到，使用 koa-generator 虽然方便，但毕竟已经3年没有更新了，许多技术栈可能已经过时，并且也包含了一些不需要的中间件，还是有必要了解如何手工搭建koa服务器的。</p><h3 id="创建项目-1" tabindex="-1"><a class="header-anchor" href="#创建项目-1" aria-hidden="true">#</a> 创建项目</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">mkdir</span> koa-init
<span class="token builtin class-name">cd</span> koa-init
<span class="token function">pnpm</span> init
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="安装依赖" tabindex="-1"><a class="header-anchor" href="#安装依赖" aria-hidden="true">#</a> 安装依赖</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">pnpm</span> i koa
<span class="token function">pnpm</span> i -D @types/koa
<span class="token comment">#  koa 版本为 2.13.4；@types/koa 是 koa 的 typescript 类型声明</span>

<span class="token function">pnpm</span> i -D typescript @types/node ts-node
<span class="token comment"># 安装 ts-node 套件，用来运行后续的 ts 代码</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>为了充分展示 Koa 的各个中间件的功能，除了核心组件外，其他中间件在过程中再安装。</p><h3 id="从-hello-world-开始" tabindex="-1"><a class="header-anchor" href="#从-hello-world-开始" aria-hidden="true">#</a> 从 Hello World 开始</h3><p>只依赖 Koa，已经足够搭建最简单的服务器应用程序。以官网上的 hello world 代码为例：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// ./app.ts</span>
<span class="token keyword">import</span> Koa <span class="token keyword">from</span> <span class="token string">&#39;koa&#39;</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">async</span> ctx <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">&#39;Hello World&#39;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在<code>package.json</code>的<code>script</code>中添加以下脚本，然后运行它</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token comment">//...</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;serve&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ts-node ./app.ts&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="highlight-lines"><br><br><br><div class="highlight-line"> </div><br><br></div><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>使用浏览器访问<code>http://localhost:3000/</code>，可以看到输出<code>Hello World</code>字符串。</p><h3 id="路由" tabindex="-1"><a class="header-anchor" href="#路由" aria-hidden="true">#</a> 路由</h3><p>现在，访问<code>http://localhost:3000/</code>的任意子路由，例如<code>/users</code>、<code>/users/bar</code>，输出结果都是<code>Hello World</code>。因为在<code>app.ts</code>的代码中，始终设置<code>ctx.body</code>为<code>Hello World</code>。</p><p>如果要实现不同的路由返回不同的字符串，不依赖其他中间件的情况下，可以这么写：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// ./app.ts</span>
<span class="token keyword">import</span> Koa <span class="token keyword">from</span> <span class="token string">&#39;koa&#39;</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">async</span> ctx <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>url <span class="token operator">===</span> <span class="token string">&#39;/&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">&#39;Hello World&#39;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>url <span class="token operator">===</span> <span class="token string">&#39;/users&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">&#39;this is a users response&#39;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>url <span class="token operator">===</span> <span class="token string">&#39;/users/bar&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">&#39;this is a users/bar response&#39;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span>
</code></pre><div class="highlight-lines"><br><br><br><br><br><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><br><br></div><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>重新运行<code>serve</code>脚本，然后分别访问<code>http://localhost:3000/</code>、<code>http://localhost:3000/users</code>、<code>http://localhost:3000/users/bar</code>以及其他路由（例如<code>http://localhost:3000/string</code>），会看到现在应用程序已经会根据不同的路由返回不同的结果了。</p><p>当然，为了避免重复造轮子，“不依赖其他中间件”的想法不可取。为了解决路由的问题，可以引入中间件<a href="https://github.com/koajs/router" target="_blank" rel="noopener noreferrer">@koa/router<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">pnpm</span> i @koa/router
<span class="token function">pnpm</span> i -D @types/koa__router
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>然后上面的代码就可以改成这样：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// ./app.ts</span>
<span class="token keyword">import</span> Koa <span class="token keyword">from</span> <span class="token string">&#39;koa&#39;</span>
<span class="token keyword">import</span> Router <span class="token keyword">from</span> <span class="token string">&#39;@koa/router&#39;</span> 

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;/&#39;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">&#39;Hello World&#39;</span>
  <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> usersRouter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

usersRouter<span class="token punctuation">.</span><span class="token function">prefix</span><span class="token punctuation">(</span><span class="token string">&#39;/users&#39;</span><span class="token punctuation">)</span>

usersRouter<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;/&#39;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">&#39;this is a users response&#39;</span>
  <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

usersRouter<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;/bar&#39;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">&#39;this is a users/bar response&#39;</span>
  <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">allowedMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>usersRouter<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>usersRouter<span class="token punctuation">.</span><span class="token function">allowedMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="custom-container tip"><p class="custom-container-title">提示</p><p>关于<code>router.allowedMethods()</code>这个中间件，在加了<code>router.allowedMethods()</code>中间件情况下，如果接口是 get 请求，而前端使用 post 请求，会返回<code>405 Method Not Allowed</code>，提示方法不被允许，并在响应头有添加允许的请求方式；而如果不加这个中间件，则会返回<code>404 Not Found</code>找不到请求地址，并且响应头没有添加允许的请求方式 。</p></div><p>为了方便中间件的设置进行后续扩展，避免主文件越来越长，一般会把路由的设置部分放在其他文件，然后在主文件中引用。</p><details class="custom-container details"><summary>代码如下</summary><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// ./app.ts</span>
<span class="token keyword">import</span> Koa <span class="token keyword">from</span> <span class="token string">&#39;koa&#39;</span>
<span class="token keyword">import</span> router <span class="token keyword">from</span> <span class="token string">&#39;./routes&#39;</span> 
<span class="token keyword">import</span> usersRouter <span class="token keyword">from</span> <span class="token string">&#39;./routes/users&#39;</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">allowedMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>usersRouter<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">allowedMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// ./routes/index.ts</span>
<span class="token keyword">import</span> Router <span class="token keyword">from</span> <span class="token string">&#39;@koa/router&#39;</span> 

<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;/&#39;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">&#39;Hello World&#39;</span>
  <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> router
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// ./routes/users.ts</span>
<span class="token keyword">import</span> Router <span class="token keyword">from</span> <span class="token string">&#39;@koa/router&#39;</span> 

<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

router<span class="token punctuation">.</span><span class="token function">prefix</span><span class="token punctuation">(</span><span class="token string">&#39;/users&#39;</span><span class="token punctuation">)</span>

router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;/&#39;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">&#39;this is a users response&#39;</span>
  <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;/bar&#39;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">&#39;this is a users/bar response&#39;</span>
  <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> router
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></details><h3 id="渲染模板" tabindex="-1"><a class="header-anchor" href="#渲染模板" aria-hidden="true">#</a> 渲染模板</h3><p>如果服务器只需要返回数据，那么<code>ctx.body</code>直接设置返回内容基本就够用了，但是如果要返回 html 页面，需要怎么处理呢？先看看“不依赖其他中间件”的情况，可以这么写：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// ./routes/index.ts</span>
<span class="token keyword">import</span> Router <span class="token keyword">from</span> <span class="token string">&#39;@koa/router&#39;</span> 

<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;/&#39;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> title <span class="token operator">=</span> <span class="token string">&#39;Koa&#39;</span>
  <span class="token keyword">const</span> slogan <span class="token operator">=</span> <span class="token string">&#39;Koa (koajs) -- 基于 Node.js 平台的下一代 web 开发框架&#39;</span>
  ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;h1&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span> title <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/h1&gt;&lt;h2&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span> slogan <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/h2&gt;</span><span class="token template-punctuation string">`</span></span>
  <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> router
</code></pre><div class="highlight-lines"><br><br><br><br><br><br><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><br><br><br><br></div><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="custom-container tip"><p class="custom-container-title">提示</p><p>Koa 会根据响应内容自动设置<code>Content-Type</code>为<code>text/html</code>或<code>text/plain</code>。在以上例子中，响应头的<code>Content-Type</code>会被设置为<code>text/html</code>（而在先前返回纯文本的例子中，该项为<code>text/plain</code>），使浏览器可以正确地以 html 的形式加载数据。</p><p>也可以使用<code>ctx.string</code>，<code>ctx.set</code>，<code>ctx.type</code>等方法显式设置响应头。</p></div><p>当需要返回复杂的 html 页面时，以上方法显然不可行。这时候就需要使用<a href="https://github.com/queckezz/koa-views" target="_blank" rel="noopener noreferrer">koa-views<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>中间件。使用<code>koa-views</code>需要选择一个模板引擎，这里选择<code>ejs</code>。</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">pnpm</span> i koa-views ejs
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>首先编写模板<code>.ejs</code>，为了方便统一管理，把模板放在 views 文件夹下。</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token comment">&lt;!-- ./views/index.ejs --&gt;</span>
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>&lt;%=title%&gt;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
<span class="token selector">body</span> <span class="token punctuation">{</span>
  <span class="token property">margin</span><span class="token punctuation">:</span> 0
<span class="token punctuation">}</span>

<span class="token selector">#heading</span> <span class="token punctuation">{</span>
  <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>
  <span class="token property">top</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span>
  <span class="token property">margin-top</span><span class="token punctuation">:</span> -5rem<span class="token punctuation">;</span>
  <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
  <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">#title</span><span class="token punctuation">{</span>
  <span class="token property">font-size</span><span class="token punctuation">:</span> 5rem<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">#slogan</span><span class="token punctuation">{</span>
  <span class="token property">font-size</span><span class="token punctuation">:</span> 1rem<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>heading<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>title<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>&lt;%=title%&gt;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>slogan<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>&lt;%=slogan%&gt;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然后修改<code>./app.ts</code>和<code>./routes/index.ts</code></p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// ./app.ts</span>
<span class="token keyword">import</span> Koa <span class="token keyword">from</span> <span class="token string">&#39;koa&#39;</span>
<span class="token keyword">import</span> router <span class="token keyword">from</span> <span class="token string">&#39;./routes&#39;</span> 
<span class="token keyword">import</span> usersRouter <span class="token keyword">from</span> <span class="token string">&#39;./routes/users&#39;</span>
<span class="token keyword">import</span> views <span class="token keyword">from</span> <span class="token string">&#39;koa-views&#39;</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 必须在路由之前引入</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">views</span><span class="token punctuation">(</span>__dirname <span class="token operator">+</span> <span class="token string">&#39;/views&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  extension<span class="token operator">:</span> <span class="token string">&#39;ejs&#39;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">allowedMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>usersRouter<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">allowedMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span>
</code></pre><div class="highlight-lines"><br><br><br><br><div class="highlight-line"> </div><br><br><br><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><br><br><br><br><br><br><br><br></div><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// ./routes/index.ts</span>
<span class="token keyword">import</span> Router <span class="token keyword">from</span> <span class="token string">&#39;@koa/router&#39;</span> 

<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;/&#39;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 注意要await，不能直接返回</span>
  <span class="token keyword">await</span> ctx<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&#39;index&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    title<span class="token operator">:</span> <span class="token string">&#39;Koa&#39;</span><span class="token punctuation">,</span>
    slogan<span class="token operator">:</span> <span class="token string">&#39;Koa (koajs) -- 基于 Node.js 平台的下一代 web 开发框架&#39;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> router
</code></pre><div class="highlight-lines"><br><br><br><br><br><br><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><br><br><br><br></div><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>重新运行<code>serve</code>脚本，访问<code>http://localhost:3000/</code>查看效果。</p><h3 id="静态文件" tabindex="-1"><a class="header-anchor" href="#静态文件" aria-hidden="true">#</a> 静态文件</h3><p>在上面的例子中，模板<code>index.ejs</code>中包含了一段样式表。当需要设置的样式很复杂时，通常会将样式表分离到单独的<code>.css</code>文件中管理。</p><p>例如新建一个<code>./public/stylesheets/style.css</code>文件，然后将<code>index.ejs</code>的样式表放入该文件中，并修改<code>index.ejs</code>以引入该外部样式表。</p><p>例如：</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token comment">&lt;!-- ./views/index.ejs --&gt;</span>
<span class="token comment">&lt;!-- ...--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>stylesheet<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text/css<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>../public/stylesheets/style.css<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- ...--&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>此时会发现无法正常加载样式文件（404 Not Found），可以尝试修改文件路径，但结果一样。</p><p>如果需要返回<code>.css</code>（以及<code>.html</code>、<code>.js</code>、<code>.jpg</code>、<code>.css</code>）这一类静态资源，通常需要引入<a href="https://github.com/koajs/static" target="_blank" rel="noopener noreferrer">koa-static<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>中间件。（原生 koa 也可以处理，但是比较麻烦）</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">pnpm</span> i koa-static
<span class="token function">pnpm</span> i -D @types/koa-static
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>然后修改<code>app.ts</code>引入中间件并设置</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// ./app.ts</span>
<span class="token keyword">import</span> Koa <span class="token keyword">from</span> <span class="token string">&#39;koa&#39;</span>
<span class="token keyword">import</span> router <span class="token keyword">from</span> <span class="token string">&#39;./routes&#39;</span> 
<span class="token keyword">import</span> usersRouter <span class="token keyword">from</span> <span class="token string">&#39;./routes/users&#39;</span>
<span class="token keyword">import</span> views <span class="token keyword">from</span> <span class="token string">&#39;koa-views&#39;</span>
<span class="token keyword">import</span> serve <span class="token keyword">from</span> <span class="token string">&#39;koa-static&#39;</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 必须在路由之前引入</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">views</span><span class="token punctuation">(</span>__dirname <span class="token operator">+</span> <span class="token string">&#39;/views&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  extension<span class="token operator">:</span> <span class="token string">&#39;ejs&#39;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">serve</span><span class="token punctuation">(</span>__dirname<span class="token operator">+</span><span class="token string">&#39;/public&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">allowedMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>usersRouter<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">allowedMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span>
</code></pre><div class="highlight-lines"><br><br><br><br><br><div class="highlight-line"> </div><br><br><br><br><br><br><br><br><div class="highlight-line"> </div><br><br><br><br><br><br><br><br></div><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>因为在<code>koa-static</code>的设置中已经指定了目录为<code>public</code>，在<code>index.ejs</code>中就不用需要用<code>../public/</code>去查找资源了。</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token comment">&lt;!-- ./views/index.ejs --&gt;</span>
<span class="token comment">&lt;!-- ...--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>stylesheet<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text/css<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>stylesheets/style.css<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- ...--&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>现在样式文件可以正常加载了。同样如果<code>public</code>目录下有其他静态资源，也可以直接通过<code>http://localhost:3000/+文件路径</code>获取。</p><p>例如有一张图片<code>public/images/logo.png</code>，那么就可以通过<code>http://localhost:3000/images/logo.png</code>获取。</p><h3 id="处理请求" tabindex="-1"><a class="header-anchor" href="#处理请求" aria-hidden="true">#</a> 处理请求</h3><p>在上面的例子中，所有的路由都是 GET 方法的，接下来看看怎么响应 POST 请求。</p><p>例如要实现一个登录接口<code>/token</code>，使用json格式请求和响应。</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>// Request
method: POST
body: 
{
  &quot;username&quot;: &quot;admin&quot;,
  &quot;password&quot;: &quot;admin&quot;
}
// Response
{
  &quot;token&quot;: &quot;2350e1c4-09f4-4f61-923c-7039b68c15ff&quot;
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果不借助中间件要获取请求的 body ，需要监听 request 对象的<code>data</code>事件及<code>end</code>事件，然后将接收到的数据进行解析，比较麻烦。因此一般都要借助中间件。</p><details class="custom-container details"><summary>手动监听并解析 body 数据的示例</summary><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code>router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&#39;/token&#39;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> str <span class="token operator">=</span> <span class="token string">&#39;&#39;</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> username<span class="token punctuation">,</span> password <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token builtin">Promise</span></span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    ctx<span class="token punctuation">.</span>req<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token string">&#39;data&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      str <span class="token operator">+=</span> data
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    ctx<span class="token punctuation">.</span>req<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token string">&#39;end&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>username <span class="token operator">===</span> <span class="token string">&#39;admin&#39;</span> <span class="token operator">&amp;&amp;</span> password <span class="token operator">===</span> <span class="token string">&#39;admin&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>
      token<span class="token operator">:</span> <span class="token string">&#39;2350e1c4-09f4-4f61-923c-7039b68c15ff&#39;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">&#39;Incorrect username or password&#39;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></details><p>针对json格式的请求，可选的中间件通常有<code>koa-bodyparser</code>和<code>koa-body</code>，这里选择<a href="https://github.com/koajs/bodyparser" target="_blank" rel="noopener noreferrer">koa-bodyparser<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><div class="custom-container tip"><p class="custom-container-title">提示</p><p><code>koa-bodyparser</code>可以处理<code>json/form/text/xml</code>类型的请求；当需要处理<code>multipart/form-data</code>类型的表单数据时（例如上传文件），则需要使用<a href="https://github.com/koajs/multer" target="_blank" rel="noopener noreferrer">@koa/multer<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>。</p><p><a href="https://github.com/dlau/koa-body" target="_blank" rel="noopener noreferrer">koa-body<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>可以代替以上两者（支持的类型更丰富），但<code>koa-bodyparser</code>和<code>@koa/multer</code>目前都是由 koa 官方维护的，并且使用的范围更广。</p></div><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">pnpm</span> i koa-bodyparser
<span class="token function">pnpm</span> i -D @types/koa-bodyparser
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>分别修改<code>app.ts</code>和<code>routes/index.ts</code>，</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// ./app.ts</span>
<span class="token keyword">import</span> Koa <span class="token keyword">from</span> <span class="token string">&#39;koa&#39;</span>
<span class="token keyword">import</span> router <span class="token keyword">from</span> <span class="token string">&#39;./routes&#39;</span> 
<span class="token keyword">import</span> usersRouter <span class="token keyword">from</span> <span class="token string">&#39;./routes/users&#39;</span>
<span class="token keyword">import</span> views <span class="token keyword">from</span> <span class="token string">&#39;koa-views&#39;</span>
<span class="token keyword">import</span> serve <span class="token keyword">from</span> <span class="token string">&#39;koa-static&#39;</span>
<span class="token keyword">import</span> bodyParser <span class="token keyword">from</span> <span class="token string">&#39;koa-bodyparser&#39;</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 必须在路由之前引入</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">views</span><span class="token punctuation">(</span>__dirname <span class="token operator">+</span> <span class="token string">&#39;/views&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  extension<span class="token operator">:</span> <span class="token string">&#39;ejs&#39;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// 必须在路由之前引入</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">bodyParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">serve</span><span class="token punctuation">(</span>__dirname<span class="token operator">+</span><span class="token string">&#39;/public&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">allowedMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>usersRouter<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">allowedMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span>
</code></pre><div class="highlight-lines"><br><br><br><br><br><br><div class="highlight-line"> </div><br><br><br><br><br><br><br><br><div class="highlight-line"> </div><div class="highlight-line"> </div><br><br><br><br><br><br><br><br><br><br></div><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// ./routes/index.ts</span>
<span class="token keyword">import</span> Router <span class="token keyword">from</span> <span class="token string">&#39;@koa/router&#39;</span> 

<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;/&#39;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 注意要await ctx.render()，不能直接返回</span>
  <span class="token keyword">await</span> ctx<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&#39;index&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    title<span class="token operator">:</span> <span class="token string">&#39;Koa&#39;</span><span class="token punctuation">,</span>
    slogan<span class="token operator">:</span> <span class="token string">&#39;Koa (koajs) -- 基于 Node.js 平台的下一代 web 开发框架&#39;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&#39;/token&#39;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> username<span class="token punctuation">,</span> password <span class="token punctuation">}</span> <span class="token operator">=</span> ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>body
  <span class="token keyword">if</span> <span class="token punctuation">(</span>username <span class="token operator">===</span> <span class="token string">&#39;admin&#39;</span> <span class="token operator">&amp;&amp;</span> password <span class="token operator">===</span> <span class="token string">&#39;admin&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>
      token<span class="token operator">:</span> <span class="token string">&#39;2350e1c4-09f4-4f61-923c-7039b68c15ff&#39;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">&#39;Incorrect username or password&#39;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> router
</code></pre><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><br><br></div><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>引入<code>koa-bodyparser</code>后，可以通过<code>ctx.request.body</code>获取解析的请求 body 。</p><h3 id="热更新" tabindex="-1"><a class="header-anchor" href="#热更新" aria-hidden="true">#</a> 热更新</h3><p>到目前为止，每次更新代码后都需要手动重启 serve 服务，修改后的代码才会生效。可以使用<a href="https://github.com/remy/nodemon" target="_blank" rel="noopener noreferrer">nodemon<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>实现热更新。</p><p>只需要安装<code>nodemon</code>后在<code>package.json</code>中添加一个以<code>nodemon</code>启动的 script。</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">pnpm</span> i -D nodemon
<span class="token comment"># 也可以全局安装nodemon `pnpm i -g nodemon`</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token comment">//...</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;serve&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ts-node ./app.ts&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;watch&quot;</span><span class="token operator">:</span> <span class="token string">&quot;nodemon --exec ts-node ./app.ts&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>运行<code>watch</code>脚本，也可以启动服务器，并且每当项目内的任何文件更新时，服务都会自动重启。</p><p>如果只想监听某些类型文件的更新（例如<code>.ts</code>）或者某个目录下文件的更新（例如<code>/routes</code>），可以这么修改命令</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code># 只监听`.ts`文件的更新
<span class="token property">&quot;watch-ts&quot;</span><span class="token operator">:</span> <span class="token string">&quot;nodemon -e ts --exec ts-node ./app.ts&quot;</span>
# 只监听`/routes`目录的更新
<span class="token property">&quot;watch-routes&quot;</span><span class="token operator">:</span> <span class="token string">&quot;nodemon --watch ./routes --exec ts-node ./app.ts&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="custom-container warning"><p class="custom-container-title">注意</p><p>单纯使用nodemon可以实现接口服务器部分的热更新（每次更新代码后会自动重启服务，重新调用接口可以获得新的数据）；但是浏览器不会自动刷新。</p><p>网上搜索到说可以使用<code>gulp-nodemon</code>+<code>browsersync</code>实现服务器自动重启+浏览器自动刷新。但试验之后<strong>不能</strong>正常使用。（可能是因为 typescript 代码只能使用ts-node运行，存在冲突）</p><p>由于笔者的服务器应用一般只用来提供数据接口，前端应用会另外搭建（使用<code>vite</code>），因此上述问题暂时不研究了。</p></div></div><!----><footer class="page-meta"><!----><div class="meta-item update-time"><span class="label">上次编辑于: </span><span class="info">2022/8/23 06:32:29</span></div><div class="meta-item contributors"><span class="label">贡献者: </span><!--[--><!--[--><span class="contributor" title="email: py_wing@qq.com">WingSnow</span><!--]--><!--]--></div></footer><nav class="page-nav"><a href="/wingsnow-blog/code/javascript/3-foreach%E3%80%81map%E3%80%81reduce%E5%92%8Cpromise.html" class="nav-link prev" aria-label="forEach、map、reduce和Promise"><div class="hint"><span class="arrow left"></span>上一页</div><div class="link"><!---->forEach、map、reduce和Promise</div></a><a href="/wingsnow-blog/code/javascript/5-package.json%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97.html" class="nav-link next" aria-label="package.json 使用指南"><div class="hint">下一页<span class="arrow right"></span></div><div class="link">package.json 使用指南<!----></div></a></nav><!----><!----><!--]--></main><!--]--><footer class="footer-wrapper"><div class="footer"></div><div class="copyright">Copyright © 2022 冬天吃雪糕</div></footer><!--]--></div><!--]--><!----><!--]--></div>
    <script type="module" src="/wingsnow-blog/assets/app.b12f069c.js" defer></script>
  </body>
</html>
